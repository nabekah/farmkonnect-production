import React, { useState } from "react";\nimport { trpc } from "@/lib/trpc\";\nimport { Card, CardContent, CardDescription, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Button } from \"@/components/ui/button\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { AlertCircle, CheckCircle, Smartphone, Trash2, Lock } from \"lucide-react\";\n\ninterface TrustedDevicesManagerProps {\n  farmId: string;\n}\n\nexport const TrustedDevicesManager: React.FC<TrustedDevicesManagerProps> = ({ farmId }) => {\n  const { data: devices = [], refetch: refetchDevices } = trpc.deviceFingerprinting.getTrustedDevices.useQuery(\n    { farmId },\n    { enabled: !!farmId }\n  );\n\n  const verifyDeviceMutation = trpc.deviceFingerprinting.verifyDevice.useMutation({\n    onSuccess: () => refetchDevices()\n  });\n\n  const removeDeviceMutation = trpc.deviceFingerprinting.removeDevice.useMutation({\n    onSuccess: () => refetchDevices()\n  });\n\n  const handleVerifyDevice = async (deviceId: number) => {\n    try {\n      await verifyDeviceMutation.mutateAsync({ deviceId });\n    } catch (error) {\n      console.error(\"Error verifying device:\", error);\n    }\n  };\n\n  const handleRemoveDevice = async (deviceId: number) => {\n    if (confirm(\"Are you sure you want to remove this device?\")) {\n      try {\n        await removeDeviceMutation.mutateAsync({ deviceId });\n      } catch (error) {\n        console.error(\"Error removing device:\", error);\n      }\n    }\n  };\n\n  return (\n    <Card>\n      <CardHeader>\n        <CardTitle>Trusted Devices</CardTitle>\n        <CardDescription>Manage devices that can access your farm account</CardDescription>\n      </CardHeader>\n      <CardContent>\n        {devices.length === 0 ? (\n          <div className=\"text-center py-8 text-gray-500\">\n            <Smartphone className=\"h-12 w-12 mx-auto mb-2 text-gray-400\" />\n            <p>No devices registered yet</p>\n          </div>\n        ) : (\n          <div className=\"space-y-3\">\n            {devices.map((device: any) => (\n              <div\n                key={device.id}\n                className=\"flex items-center justify-between p-4 border rounded-lg hover:bg-gray-50\"\n              >\n                <div className=\"flex-1\">\n                  <div className=\"flex items-center gap-2 mb-1\">\n                    <Smartphone className=\"h-4 w-4 text-gray-600\" />\n                    <p className=\"font-medium\">{device.deviceName}</p>\n                    {device.isVerified ? (\n                      <Badge className=\"bg-green-100 text-green-800\">\n                        <CheckCircle className=\"h-3 w-3 mr-1\" />\n                        Verified\n                      </Badge>\n                    ) : (\n                      <Badge className=\"bg-yellow-100 text-yellow-800\">\n                        <AlertCircle className=\"h-3 w-3 mr-1\" />\n                        Unverified\n                      </Badge>\n                    )}\n                  </div>\n                  <p className=\"text-sm text-gray-600\">\n                    {device.browserType} on {device.osType}\n                  </p>\n                  <p className=\"text-xs text-gray-500\">\n                    IP: {device.ipAddress} â€¢ Last seen: {new Date(device.lastSeenAt).toLocaleDateString()}\n                  </p>\n                </div>\n                <div className=\"flex gap-2\">\n                  {!device.isVerified && (\n                    <Button\n                      size=\"sm\"\n                      variant=\"outline\"\n                      onClick={() => handleVerifyDevice(device.id)}\n                      disabled={verifyDeviceMutation.isPending}\n                    >\n                      <Lock className=\"h-4 w-4 mr-1\" />\n                      Verify\n                    </Button>\n                  )}\n                  <Button\n                    size=\"sm\"\n                    variant=\"destructive\"\n                    onClick={() => handleRemoveDevice(device.id)}\n                    disabled={removeDeviceMutation.isPending}\n                  >\n                    <Trash2 className=\"h-4 w-4\" />\n                  </Button>\n                </div>\n              </div>\n            ))}\n          </div>\n        )}\n      </CardContent>\n    </Card>\n  );\n};\n
