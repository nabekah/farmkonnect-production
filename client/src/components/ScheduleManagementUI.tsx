import React, { useState, useCallback } from 'react';\nimport { Button } from '@/components/ui/button';\nimport { Card } from '@/components/ui/card';\nimport { Input } from '@/components/ui/input';\nimport { Plus, Pause, Play, Trash2, Edit2, Clock, CheckCircle, AlertCircle, TrendingUp } from 'lucide-react';\n\nexport type ReportFrequency = 'daily' | 'weekly' | 'monthly' | 'quarterly';\nexport type ScheduleStatus = 'active' | 'paused' | 'completed' | 'failed';\n\nexport interface Schedule {\n  id: string;\n  name: string;\n  reportType: string;\n  frequency: ReportFrequency;\n  time: string;\n  recipients: string[];\n  status: ScheduleStatus;\n  nextRunAt: number;\n  lastRunAt?: number;\n  runCount: number;\n  successRate: number;\n}\n\nexport interface ScheduleMetrics {\n  totalSchedules: number;\n  activeSchedules: number;\n  pausedSchedules: number;\n  totalExecutions: number;\n  successfulExecutions: number;\n  averageSuccessRate: number;\n}\n\nexport interface ScheduleManagementUIProps {\n  schedules: Schedule[];\n  metrics: ScheduleMetrics;\n  onCreateSchedule?: () => void;\n  onPauseSchedule?: (scheduleId: string) => void;\n  onResumeSchedule?: (scheduleId: string) => void;\n  onDeleteSchedule?: (scheduleId: string) => void;\n  onEditSchedule?: (scheduleId: string) => void;\n}\n\nconst FREQUENCY_LABELS: Record<ReportFrequency, string> = {\n  daily: 'Daily',\n  weekly: 'Weekly',\n  monthly: 'Monthly',\n  quarterly: 'Quarterly',\n};\n\nconst STATUS_CONFIG: Record<ScheduleStatus, { color: string; icon: React.ReactNode; label: string }> = {\n  active: {\n    color: 'text-green-600 bg-green-50',\n    icon: <CheckCircle className=\"w-4 h-4\" />,\n    label: 'Active',\n  },\n  paused: {\n    color: 'text-yellow-600 bg-yellow-50',\n    icon: <Clock className=\"w-4 h-4\" />,\n    label: 'Paused',\n  },\n  completed: {\n    color: 'text-blue-600 bg-blue-50',\n    icon: <CheckCircle className=\"w-4 h-4\" />,\n    label: 'Completed',\n  },\n  failed: {\n    color: 'text-red-600 bg-red-50',\n    icon: <AlertCircle className=\"w-4 h-4\" />,\n    label: 'Failed',\n  },\n};\n\ninterface ScheduleCardProps {\n  schedule: Schedule;\n  onPause?: () => void;\n  onResume?: () => void;\n  onDelete?: () => void;\n  onEdit?: () => void;\n}\n\nconst ScheduleCard: React.FC<ScheduleCardProps> = ({ schedule, onPause, onResume, onDelete, onEdit }) => {\n  const statusConfig = STATUS_CONFIG[schedule.status];\n  const nextRun = new Date(schedule.nextRunAt);\n  const lastRun = schedule.lastRunAt ? new Date(schedule.lastRunAt) : null;\n\n  const getSuccessRateColor = (rate: number) => {\n    if (rate >= 95) return 'text-green-600';\n    if (rate >= 80) return 'text-yellow-600';\n    return 'text-red-600';\n  };\n\n  return (\n    <Card className=\"p-4 hover:shadow-md transition-shadow\">\n      <div className=\"flex items-start justify-between mb-4\">\n        <div className=\"flex-1\">\n          <div className=\"flex items-center gap-2 mb-2\">\n            <h3 className=\"font-semibold text-lg\">{schedule.name}</h3>\n            <span className={`px-2 py-1 rounded text-xs font-medium flex items-center gap-1 ${statusConfig.color}`}>\n              {statusConfig.icon}\n              {statusConfig.label}\n            </span>\n          </div>\n          <p className=\"text-sm text-gray-600\">{schedule.reportType}</p>\n        </div>\n        <div className=\"flex gap-2\">\n          {schedule.status === 'active' && (\n            <Button variant=\"ghost\" size=\"sm\" onClick={onPause} className=\"text-yellow-600 hover:text-yellow-700\">\n              <Pause className=\"w-4 h-4\" />\n            </Button>\n          )}\n          {schedule.status === 'paused' && (\n            <Button variant=\"ghost\" size=\"sm\" onClick={onResume} className=\"text-green-600 hover:text-green-700\">\n              <Play className=\"w-4 h-4\" />\n            </Button>\n          )}\n          <Button variant=\"ghost\" size=\"sm\" onClick={onEdit} className=\"text-blue-600 hover:text-blue-700\">\n            <Edit2 className=\"w-4 h-4\" />\n          </Button>\n          <Button variant=\"ghost\" size=\"sm\" onClick={onDelete} className=\"text-red-600 hover:text-red-700\">\n            <Trash2 className=\"w-4 h-4\" />\n          </Button>\n        </div>\n      </div>\n\n      <div className=\"grid grid-cols-2 gap-4 mb-4\">\n        <div>\n          <p className=\"text-xs text-gray-600 mb-1\">Frequency</p>\n          <p className=\"font-medium text-sm\">{FREQUENCY_LABELS[schedule.frequency]}</p>\n        </div>\n        <div>\n          <p className=\"text-xs text-gray-600 mb-1\">Time</p>\n          <p className=\"font-medium text-sm\">{schedule.time}</p>\n        </div>\n        <div>\n          <p className=\"text-xs text-gray-600 mb-1\">Next Run</p>\n          <p className=\"font-medium text-sm\">{nextRun.toLocaleDateString()} {nextRun.toLocaleTimeString()}</p>\n        </div>\n        <div>\n          <p className=\"text-xs text-gray-600 mb-1\">Recipients</p>\n          <p className=\"font-medium text-sm\">{schedule.recipients.length} recipients</p>\n        </div>\n      </div>\n\n      <div className=\"grid grid-cols-3 gap-4 pt-4 border-t\">\n        <div>\n          <p className=\"text-xs text-gray-600 mb-1\">Total Runs</p>\n          <p className=\"text-lg font-bold\">{schedule.runCount}</p>\n        </div>\n        <div>\n          <p className=\"text-xs text-gray-600 mb-1\">Success Rate</p>\n          <p className={`text-lg font-bold ${getSuccessRateColor(schedule.successRate)}`}>\n            {schedule.successRate.toFixed(1)}%\n          </p>\n        </div>\n        <div>\n          <p className=\"text-xs text-gray-600 mb-1\">Last Run</p>\n          <p className=\"text-sm font-medium\">\n            {lastRun ? lastRun.toLocaleDateString() : 'Never'}\n          </p>\n        </div>\n      </div>\n    </Card>\n  );\n};\n\ninterface MetricCardProps {\n  label: string;\n  value: number | string;\n  icon: React.ReactNode;\n  color: string;\n}\n\nconst MetricCard: React.FC<MetricCardProps> = ({ label, value, icon, color }) => {\n  return (\n    <Card className=\"p-4\">\n      <div className=\"flex items-center justify-between\">\n        <div>\n          <p className=\"text-sm text-gray-600 mb-1\">{label}</p>\n          <p className={`text-2xl font-bold ${color}`}>{value}</p>\n        </div>\n        <div className={`p-3 rounded-lg ${color} bg-opacity-10`}>{icon}</div>\n      </div>\n    </Card>\n  );\n};\n\nexport const ScheduleManagementUI: React.FC<ScheduleManagementUIProps> = ({\n  schedules,\n  metrics,\n  onCreateSchedule,\n  onPauseSchedule,\n  onResumeSchedule,\n  onDeleteSchedule,\n  onEditSchedule,\n}) => {\n  const [filterStatus, setFilterStatus] = useState<ScheduleStatus | 'all'>('all');\n\n  const filteredSchedules = schedules.filter((s) => (filterStatus === 'all' ? true : s.status === filterStatus));\n\n  return (\n    <div className=\"space-y-6 max-w-7xl mx-auto\">\n      {/* Header */}\n      <div className=\"flex items-center justify-between\">\n        <div>\n          <h2 className=\"text-2xl font-bold\">Report Schedules</h2>\n          <p className=\"text-gray-600 text-sm mt-1\">Manage and monitor your automated report schedules</p>\n        </div>\n        <Button onClick={onCreateSchedule} className=\"bg-blue-600 hover:bg-blue-700\">\n          <Plus className=\"w-4 h-4 mr-2\" />\n          Create Schedule\n        </Button>\n      </div>\n\n      {/* Metrics */}\n      <div className=\"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-4\">\n        <MetricCard\n          label=\"Total Schedules\"\n          value={metrics.totalSchedules}\n          icon={<Clock className=\"w-6 h-6\" />}\n          color=\"text-blue-600\"\n        />\n        <MetricCard\n          label=\"Active\"\n          value={metrics.activeSchedules}\n          icon={<CheckCircle className=\"w-6 h-6\" />}\n          color=\"text-green-600\"\n        />\n        <MetricCard\n          label=\"Total Executions\"\n          value={metrics.totalExecutions}\n          icon={<TrendingUp className=\"w-6 h-6\" />}\n          color=\"text-purple-600\"\n        />\n        <MetricCard\n          label=\"Success Rate\"\n          value={`${metrics.averageSuccessRate.toFixed(1)}%`}\n          icon={<CheckCircle className=\"w-6 h-6\" />}\n          color=\"text-green-600\"\n        />\n      </div>\n\n      {/* Filters */}\n      <Card className=\"p-4\">\n        <p className=\"text-sm font-medium mb-3\">Filter by Status</p>\n        <div className=\"flex gap-2 flex-wrap\">\n          {(['all', 'active', 'paused', 'completed', 'failed'] as const).map((status) => (\n            <button\n              key={status}\n              onClick={() => setFilterStatus(status)}\n              className={`px-4 py-2 rounded text-sm font-medium transition-all ${\n                filterStatus === status\n                  ? 'bg-blue-600 text-white'\n                  : 'bg-gray-100 text-gray-700 hover:bg-gray-200'\n              }`}\n            >\n              {status === 'all' ? 'All Schedules' : STATUS_CONFIG[status as ScheduleStatus].label}\n            </button>\n          ))}\n        </div>\n      </Card>\n\n      {/* Schedules List */}\n      {filteredSchedules.length > 0 ? (\n        <div className=\"grid grid-cols-1 lg:grid-cols-2 gap-4\">\n          {filteredSchedules.map((schedule) => (\n            <ScheduleCard\n              key={schedule.id}\n              schedule={schedule}\n              onPause={() => onPauseSchedule?.(schedule.id)}\n              onResume={() => onResumeSchedule?.(schedule.id)}\n              onDelete={() => onDeleteSchedule?.(schedule.id)}\n              onEdit={() => onEditSchedule?.(schedule.id)}\n            />\n          ))}\n        </div>\n      ) : (\n        <Card className=\"p-12 text-center\">\n          <Clock className=\"w-12 h-12 text-gray-400 mx-auto mb-4\" />\n          <p className=\"text-gray-600 mb-4\">No schedules found</p>\n          <Button onClick={onCreateSchedule} className=\"bg-blue-600 hover:bg-blue-700\">\n            <Plus className=\"w-4 h-4 mr-2\" />\n            Create Your First Schedule\n          </Button>\n        </Card>\n      )}\n\n      {/* Calendar View */}\n      <Card className=\"p-6\">\n        <h3 className=\"font-semibold mb-4\">Upcoming Schedules (Next 7 Days)</h3>\n        <div className=\"space-y-2\">\n          {schedules\n            .filter((s) => s.status === 'active')\n            .sort((a, b) => a.nextRunAt - b.nextRunAt)\n            .slice(0, 5)\n            .map((schedule) => {\n              const nextRun = new Date(schedule.nextRunAt);\n              const daysUntil = Math.ceil((schedule.nextRunAt - Date.now()) / (1000 * 60 * 60 * 24));\n\n              return (\n                <div key={schedule.id} className=\"flex items-center justify-between p-3 bg-gray-50 rounded hover:bg-gray-100 transition-colors\">\n                  <div className=\"flex-1\">\n                    <p className=\"font-medium text-sm\">{schedule.name}</p>\n                    <p className=\"text-xs text-gray-600\">\n                      {nextRun.toLocaleDateString()} at {nextRun.toLocaleTimeString()}\n                    </p>\n                  </div>\n                  <div className=\"text-right\">\n                    <p className=\"font-medium text-sm\">{FREQUENCY_LABELS[schedule.frequency]}</p>\n                    <p className=\"text-xs text-gray-600\">\n                      {daysUntil === 0 ? 'Today' : daysUntil === 1 ? 'Tomorrow' : `In ${daysUntil} days`}\n                    </p>\n                  </div>\n                </div>\n              );\n            })}\n        </div>\n      </Card>\n    </div>\n  );\n};\n\nexport default ScheduleManagementUI;\n
