import React, { useState, useEffect } from 'react';\nimport { Button } from '@/components/ui/button';\nimport { Card, CardContent, CardDescription, CardHeader, CardTitle } from '@/components/ui/card';\nimport { Switch } from '@/components/ui/switch';\nimport { Input } from '@/components/ui/input';\nimport { Label } from '@/components/ui/label';\nimport { Tabs, TabsContent, TabsList, TabsTrigger } from '@/components/ui/tabs';\nimport { AlertCircle, Bell, Mail, MessageSquare, Clock, Save, Check } from 'lucide-react';\n\ninterface PreferenceState {\n  emailOptIn: boolean;\n  smsOptIn: boolean;\n  preferredChannels: ('email' | 'sms')[];\n  emailAddress: string;\n  phoneNumber: string;\n  doNotDisturbStart?: number;\n  doNotDisturbEnd?: number;\n  notificationFrequency: 'immediate' | 'daily' | 'weekly';\n  notificationCategories: Record<string, boolean>;\n}\n\nconst UserPreferenceCenter: React.FC = () => {\n  const [preferences, setPreferences] = useState<PreferenceState>({\n    emailOptIn: true,\n    smsOptIn: false,\n    preferredChannels: ['email'],\n    emailAddress: '',\n    phoneNumber: '',\n    notificationFrequency: 'immediate',\n    notificationCategories: {\n      marketing: true,\n      updates: true,\n      alerts: true,\n      recommendations: false,\n      promotions: false,\n    },\n  });\n\n  const [saved, setSaved] = useState(false);\n  const [loading, setLoading] = useState(false);\n  const [error, setError] = useState<string | null>(null);\n\n  useEffect(() => {\n    // Fetch user preferences\n    const fetchPreferences = async () => {\n      try {\n        // In a real app, this would call the API\n        // const response = await fetch('/api/preferences');\n        // const data = await response.json();\n        // setPreferences(data);\n      } catch (err) {\n        setError('Failed to load preferences');\n      }\n    };\n\n    fetchPreferences();\n  }, []);\n\n  const handleChannelToggle = (channel: 'email' | 'sms') => {\n    setPreferences((prev) => {\n      const channels = prev.preferredChannels.includes(channel)\n        ? prev.preferredChannels.filter((c) => c !== channel)\n        : [...prev.preferredChannels, channel];\n\n      return {\n        ...prev,\n        preferredChannels: channels,\n        emailOptIn: channel === 'email' ? !prev.emailOptIn : prev.emailOptIn,\n        smsOptIn: channel === 'sms' ? !prev.smsOptIn : prev.smsOptIn,\n      };\n    });\n  };\n\n  const handleCategoryToggle = (category: string) => {\n    setPreferences((prev) => ({\n      ...prev,\n      notificationCategories: {\n        ...prev.notificationCategories,\n        [category]: !prev.notificationCategories[category],\n      },\n    }));\n  };\n\n  const handleDoNotDisturbChange = (start: number, end: number) => {\n    setPreferences((prev) => ({\n      ...prev,\n      doNotDisturbStart: start,\n      doNotDisturbEnd: end,\n    }));\n  };\n\n  const handleSave = async () => {\n    setLoading(true);\n    setError(null);\n\n    try {\n      // In a real app, this would call the API\n      // const response = await fetch('/api/preferences', {\n      //   method: 'PUT',\n      //   headers: { 'Content-Type': 'application/json' },\n      //   body: JSON.stringify(preferences),\n      // });\n      // if (!response.ok) throw new Error('Failed to save');\n\n      setSaved(true);\n      setTimeout(() => setSaved(false), 3000);\n    } catch (err) {\n      setError(err instanceof Error ? err.message : 'Failed to save preferences');\n    } finally {\n      setLoading(false);\n    }\n  };\n\n  return (\n    <div className=\"w-full max-w-4xl mx-auto p-4\">\n      <div className=\"mb-8\">\n        <h1 className=\"text-3xl font-bold mb-2\">Notification Preferences</h1>\n        <p className=\"text-gray-600\">Manage how and when you receive notifications</p>\n      </div>\n\n      {error && (\n        <Card className=\"mb-6 border-red-200 bg-red-50\">\n          <CardContent className=\"pt-6 flex items-center gap-3\">\n            <AlertCircle className=\"w-5 h-5 text-red-600\" />\n            <span className=\"text-red-800\">{error}</span>\n          </CardContent>\n        </Card>\n      )}\n\n      {saved && (\n        <Card className=\"mb-6 border-green-200 bg-green-50\">\n          <CardContent className=\"pt-6 flex items-center gap-3\">\n            <Check className=\"w-5 h-5 text-green-600\" />\n            <span className=\"text-green-800\">Preferences saved successfully</span>\n          </CardContent>\n        </Card>\n      )}\n\n      <Tabs defaultValue=\"channels\" className=\"w-full\">\n        <TabsList className=\"grid w-full grid-cols-4\">\n          <TabsTrigger value=\"channels\">Channels</TabsTrigger>\n          <TabsTrigger value=\"categories\">Categories</TabsTrigger>\n          <TabsTrigger value=\"frequency\">Frequency</TabsTrigger>\n          <TabsTrigger value=\"quiet-hours\">Quiet Hours</TabsTrigger>\n        </TabsList>\n\n        {/* Channels Tab */}\n        <TabsContent value=\"channels\" className=\"space-y-6\">\n          <Card>\n            <CardHeader>\n              <CardTitle className=\"flex items-center gap-2\">\n                <Mail className=\"w-5 h-5\" />\n                Email Notifications\n              </CardTitle>\n              <CardDescription>Receive notifications via email</CardDescription>\n            </CardHeader>\n            <CardContent className=\"space-y-4\">\n              <div className=\"flex items-center justify-between\">\n                <Label htmlFor=\"email-toggle\" className=\"text-base\">Enable Email</Label>\n                <Switch\n                  id=\"email-toggle\"\n                  checked={preferences.emailOptIn}\n                  onCheckedChange={() => handleChannelToggle('email')}\n                />\n              </div>\n\n              {preferences.emailOptIn && (\n                <div className=\"space-y-2\">\n                  <Label htmlFor=\"email-address\">Email Address</Label>\n                  <Input\n                    id=\"email-address\"\n                    type=\"email\"\n                    placeholder=\"your@email.com\"\n                    value={preferences.emailAddress}\n                    onChange={(e) =>\n                      setPreferences((prev) => ({\n                        ...prev,\n                        emailAddress: e.target.value,\n                      }))\n                    }\n                  />\n                </div>\n              )}\n            </CardContent>\n          </Card>\n\n          <Card>\n            <CardHeader>\n              <CardTitle className=\"flex items-center gap-2\">\n                <MessageSquare className=\"w-5 h-5\" />\n                SMS Notifications\n              </CardTitle>\n              <CardDescription>Receive notifications via text message</CardDescription>\n            </CardHeader>\n            <CardContent className=\"space-y-4\">\n              <div className=\"flex items-center justify-between\">\n                <Label htmlFor=\"sms-toggle\" className=\"text-base\">Enable SMS</Label>\n                <Switch\n                  id=\"sms-toggle\"\n                  checked={preferences.smsOptIn}\n                  onCheckedChange={() => handleChannelToggle('sms')}\n                />\n              </div>\n\n              {preferences.smsOptIn && (\n                <div className=\"space-y-2\">\n                  <Label htmlFor=\"phone-number\">Phone Number</Label>\n                  <Input\n                    id=\"phone-number\"\n                    type=\"tel\"\n                    placeholder=\"+1 (555) 123-4567\"\n                    value={preferences.phoneNumber}\n                    onChange={(e) =>\n                      setPreferences((prev) => ({\n                        ...prev,\n                        phoneNumber: e.target.value,\n                      }))\n                    }\n                  />\n                </div>\n              )}\n            </CardContent>\n          </Card>\n        </TabsContent>\n\n        {/* Categories Tab */}\n        <TabsContent value=\"categories\" className=\"space-y-6\">\n          <Card>\n            <CardHeader>\n              <CardTitle className=\"flex items-center gap-2\">\n                <Bell className=\"w-5 h-5\" />\n                Notification Categories\n              </CardTitle>\n              <CardDescription>Choose which types of notifications you want to receive</CardDescription>\n            </CardHeader>\n            <CardContent className=\"space-y-4\">\n              {Object.entries(preferences.notificationCategories).map(([category, enabled]) => (\n                <div key={category} className=\"flex items-center justify-between\">\n                  <Label htmlFor={`category-${category}`} className=\"text-base capitalize\">\n                    {category}\n                  </Label>\n                  <Switch\n                    id={`category-${category}`}\n                    checked={enabled}\n                    onCheckedChange={() => handleCategoryToggle(category)}\n                  />\n                </div>\n              ))}\n            </CardContent>\n          </Card>\n        </TabsContent>\n\n        {/* Frequency Tab */}\n        <TabsContent value=\"frequency\" className=\"space-y-6\">\n          <Card>\n            <CardHeader>\n              <CardTitle>Notification Frequency</CardTitle>\n              <CardDescription>How often you want to receive notifications</CardDescription>\n            </CardHeader>\n            <CardContent className=\"space-y-4\">\n              <div className=\"space-y-3\">\n                {(['immediate', 'daily', 'weekly'] as const).map((freq) => (\n                  <div key={freq} className=\"flex items-center\">\n                    <input\n                      type=\"radio\"\n                      id={`freq-${freq}`}\n                      name=\"frequency\"\n                      value={freq}\n                      checked={preferences.notificationFrequency === freq}\n                      onChange={(e) =>\n                        setPreferences((prev) => ({\n                          ...prev,\n                          notificationFrequency: e.target.value as PreferenceState['notificationFrequency'],\n                        }))\n                      }\n                      className=\"w-4 h-4\"\n                    />\n                    <Label htmlFor={`freq-${freq}`} className=\"ml-3 text-base capitalize cursor-pointer\">\n                      {freq === 'immediate'\n                        ? 'Receive immediately'\n                        : freq === 'daily'\n                          ? 'Daily digest'\n                          : 'Weekly digest'}\n                    </Label>\n                  </div>\n                ))}\n              </div>\n            </CardContent>\n          </Card>\n        </TabsContent>\n\n        {/* Quiet Hours Tab */}\n        <TabsContent value=\"quiet-hours\" className=\"space-y-6\">\n          <Card>\n            <CardHeader>\n              <CardTitle className=\"flex items-center gap-2\">\n                <Clock className=\"w-5 h-5\" />\n                Do Not Disturb Hours\n              </CardTitle>\n              <CardDescription>Set times when you don't want to receive notifications</CardDescription>\n            </CardHeader>\n            <CardContent className=\"space-y-4\">\n              <div className=\"grid grid-cols-2 gap-4\">\n                <div className=\"space-y-2\">\n                  <Label htmlFor=\"start-hour\">Start Time</Label>\n                  <select\n                    id=\"start-hour\"\n                    value={preferences.doNotDisturbStart || 22}\n                    onChange={(e) =>\n                      handleDoNotDisturbChange(\n                        parseInt(e.target.value),\n                        preferences.doNotDisturbEnd || 8\n                      )\n                    }\n                    className=\"w-full px-3 py-2 border border-gray-300 rounded-md\"\n                  >\n                    {Array.from({ length: 24 }, (_, i) => (\n                      <option key={i} value={i}>\n                        {i.toString().padStart(2, '0')}:00\n                      </option>\n                    ))}\n                  </select>\n                </div>\n                <div className=\"space-y-2\">\n                  <Label htmlFor=\"end-hour\">End Time</Label>\n                  <select\n                    id=\"end-hour\"\n                    value={preferences.doNotDisturbEnd || 8}\n                    onChange={(e) =>\n                      handleDoNotDisturbChange(\n                        preferences.doNotDisturbStart || 22,\n                        parseInt(e.target.value)\n                      )\n                    }\n                    className=\"w-full px-3 py-2 border border-gray-300 rounded-md\"\n                  >\n                    {Array.from({ length: 24 }, (_, i) => (\n                      <option key={i} value={i}>\n                        {i.toString().padStart(2, '0')}:00\n                      </option>\n                    ))}\n                  </select>\n                </div>\n              </div>\n              <p className=\"text-sm text-gray-600\">\n                Notifications will be paused from{' '}\n                {(preferences.doNotDisturbStart || 22).toString().padStart(2, '0')}:00 to{' '}\n                {(preferences.doNotDisturbEnd || 8).toString().padStart(2, '0')}:00\n              </p>\n            </CardContent>\n          </Card>\n        </TabsContent>\n      </Tabs>\n\n      <div className=\"mt-8 flex gap-3\">\n        <Button\n          onClick={handleSave}\n          disabled={loading}\n          className=\"flex items-center gap-2\"\n        >\n          <Save className=\"w-4 h-4\" />\n          {loading ? 'Saving...' : 'Save Preferences'}\n        </Button>\n        <Button variant=\"outline\">Reset to Defaults</Button>\n      </div>\n    </div>\n  );\n};\n\nexport default UserPreferenceCenter;\n
