import React, { useState, useCallback } from 'react';\nimport { Button } from '@/components/ui/button';\nimport { Card } from '@/components/ui/card';\nimport { Input } from '@/components/ui/input';\nimport { Plus, Trash2, Save, Copy, Zap } from 'lucide-react';\n\nexport type FilterOperator = 'equals' | 'not_equals' | 'contains' | 'gt' | 'lt' | 'gte' | 'lte' | 'between' | 'in';\n\nexport interface FilterCondition {\n  id: string;\n  field: string;\n  operator: FilterOperator;\n  value: any;\n}\n\nexport interface QuickFilter {\n  id: string;\n  name: string;\n  label: string;\n  icon: string;\n  color: string;\n  recipientCount: number;\n}\n\nexport interface FilterBuilderUIProps {\n  onSave?: (filters: FilterCondition[], name: string) => void;\n  onApply?: (filters: FilterCondition[]) => void;\n  quickFilters?: QuickFilter[];\n  onQuickFilterClick?: (filterId: string) => void;\n}\n\nconst ATTRIBUTES = [\n  { value: 'email', label: 'Email' },\n  { value: 'name', label: 'Name' },\n  { value: 'engagement_score', label: 'Engagement Score' },\n  { value: 'churn_risk', label: 'Churn Risk' },\n  { value: 'total_opens', label: 'Total Opens' },\n  { value: 'total_clicks', label: 'Total Clicks' },\n  { value: 'total_conversions', label: 'Total Conversions' },\n  { value: 'days_since_activity', label: 'Days Since Activity' },\n  { value: 'subscription_status', label: 'Subscription Status' },\n];\n\nconst OPERATORS: Record<string, { value: FilterOperator; label: string }[]> = {\n  email: [\n    { value: 'equals', label: 'Equals' },\n    { value: 'contains', label: 'Contains' },\n    { value: 'in', label: 'In List' },\n  ],\n  name: [\n    { value: 'equals', label: 'Equals' },\n    { value: 'contains', label: 'Contains' },\n  ],\n  engagement_score: [\n    { value: 'equals', label: 'Equals' },\n    { value: 'gt', label: 'Greater Than' },\n    { value: 'lt', label: 'Less Than' },\n    { value: 'gte', label: 'Greater or Equal' },\n    { value: 'lte', label: 'Less or Equal' },\n    { value: 'between', label: 'Between' },\n  ],\n  churn_risk: [\n    { value: 'equals', label: 'Equals' },\n    { value: 'gt', label: 'Greater Than' },\n    { value: 'lt', label: 'Less Than' },\n    { value: 'gte', label: 'Greater or Equal' },\n    { value: 'lte', label: 'Less or Equal' },\n  ],\n  total_opens: [\n    { value: 'equals', label: 'Equals' },\n    { value: 'gt', label: 'Greater Than' },\n    { value: 'lt', label: 'Less Than' },\n  ],\n  total_clicks: [\n    { value: 'equals', label: 'Equals' },\n    { value: 'gt', label: 'Greater Than' },\n    { value: 'lt', label: 'Less Than' },\n  ],\n  total_conversions: [\n    { value: 'equals', label: 'Equals' },\n    { value: 'gt', label: 'Greater Than' },\n    { value: 'lt', label: 'Less Than' },\n  ],\n  days_since_activity: [\n    { value: 'equals', label: 'Equals' },\n    { value: 'gt', label: 'Greater Than' },\n    { value: 'lt', label: 'Less Than' },\n    { value: 'gte', label: 'Greater or Equal' },\n    { value: 'lte', label: 'Less or Equal' },\n  ],\n  subscription_status: [\n    { value: 'equals', label: 'Equals' },\n    { value: 'in', label: 'In List' },\n  ],\n};\n\ninterface ConditionRowProps {\n  condition: FilterCondition;\n  onUpdate: (condition: FilterCondition) => void;\n  onDelete: () => void;\n}\n\nconst ConditionRow: React.FC<ConditionRowProps> = ({ condition, onUpdate, onDelete }) => {\n  const availableOperators = OPERATORS[condition.field] || OPERATORS['email'];\n\n  return (\n    <div className=\"flex gap-2 items-end p-3 bg-gray-50 rounded border border-gray-200 hover:border-gray-300 transition-colors\">\n      <div className=\"flex-1\">\n        <label className=\"text-xs font-medium text-gray-600 block mb-1\">Attribute</label>\n        <select\n          value={condition.field}\n          onChange={(e) => onUpdate({ ...condition, field: e.target.value })}\n          className=\"w-full px-3 py-2 border border-gray-300 rounded text-sm focus:outline-none focus:ring-2 focus:ring-blue-500\"\n        >\n          {ATTRIBUTES.map((attr) => (\n            <option key={attr.value} value={attr.value}>\n              {attr.label}\n            </option>\n          ))}\n        </select>\n      </div>\n\n      <div className=\"flex-1\">\n        <label className=\"text-xs font-medium text-gray-600 block mb-1\">Operator</label>\n        <select\n          value={condition.operator}\n          onChange={(e) => onUpdate({ ...condition, operator: e.target.value as FilterOperator })}\n          className=\"w-full px-3 py-2 border border-gray-300 rounded text-sm focus:outline-none focus:ring-2 focus:ring-blue-500\"\n        >\n          {availableOperators.map((op) => (\n            <option key={op.value} value={op.value}>\n              {op.label}\n            </option>\n          ))}\n        </select>\n      </div>\n\n      <div className=\"flex-1\">\n        <label className=\"text-xs font-medium text-gray-600 block mb-1\">Value</label>\n        <Input\n          value={condition.value}\n          onChange={(e) => onUpdate({ ...condition, value: e.target.value })}\n          placeholder=\"Enter value\"\n          className=\"text-sm\"\n        />\n      </div>\n\n      <Button\n        variant=\"ghost\"\n        size=\"sm\"\n        onClick={onDelete}\n        className=\"text-red-600 hover:text-red-700 hover:bg-red-50\"\n      >\n        <Trash2 className=\"w-4 h-4\" />\n      </Button>\n    </div>\n  );\n};\n\nexport const FilterBuilderUI: React.FC<FilterBuilderUIProps> = ({\n  onSave,\n  onApply,\n  quickFilters = [],\n  onQuickFilterClick,\n}) => {\n  const [conditions, setConditions] = useState<FilterCondition[]>([\n    {\n      id: `cond-${Date.now()}`,\n      field: 'email',\n      operator: 'equals',\n      value: '',\n    },\n  ]);\n  const [filterName, setFilterName] = useState('');\n  const [recipientCount, setRecipientCount] = useState(0);\n  const [showSaveForm, setShowSaveForm] = useState(false);\n\n  const addCondition = useCallback(() => {\n    const newCondition: FilterCondition = {\n      id: `cond-${Date.now()}`,\n      field: 'email',\n      operator: 'equals',\n      value: '',\n    };\n    setConditions([...conditions, newCondition]);\n  }, [conditions]);\n\n  const updateCondition = useCallback(\n    (index: number, condition: FilterCondition) => {\n      const newConditions = [...conditions];\n      newConditions[index] = condition;\n      setConditions(newConditions);\n      // Simulate recipient count update\n      setRecipientCount(Math.floor(Math.random() * 10000) + 100);\n    },\n    [conditions]\n  );\n\n  const deleteCondition = useCallback(\n    (index: number) => {\n      setConditions(conditions.filter((_, i) => i !== index));\n    },\n    [conditions]\n  );\n\n  const handleSave = useCallback(() => {\n    if (!filterName.trim()) {\n      alert('Please enter a filter name');\n      return;\n    }\n    onSave?.(conditions, filterName);\n    setFilterName('');\n    setShowSaveForm(false);\n  }, [conditions, filterName, onSave]);\n\n  const handleApply = useCallback(() => {\n    onApply?.(conditions);\n  }, [conditions, onApply]);\n\n  return (\n    <div className=\"space-y-6 max-w-6xl mx-auto\">\n      {/* Header */}\n      <div>\n        <h2 className=\"text-2xl font-bold\">Filter Builder</h2>\n        <p className=\"text-gray-600 text-sm mt-1\">Create custom filters to target specific recipient segments</p>\n      </div>\n\n      {/* Quick Filters */}\n      {quickFilters.length > 0 && (\n        <Card className=\"p-4\">\n          <h3 className=\"font-semibold mb-3 flex items-center gap-2\">\n            <Zap className=\"w-4 h-4 text-yellow-500\" />\n            Quick Filters\n          </h3>\n          <div className=\"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-5 gap-2\">\n            {quickFilters.map((qf) => (\n              <button\n                key={qf.id}\n                onClick={() => onQuickFilterClick?.(qf.id)}\n                className={`p-3 rounded border-2 transition-all text-left hover:shadow-md`}\n                style={{\n                  borderColor: qf.color,\n                  backgroundColor: `${qf.color}15`,\n                }}\n              >\n                <div className=\"flex items-center gap-2 mb-2\">\n                  <span className=\"text-lg\">{qf.icon}</span>\n                  <span className=\"font-medium text-sm\">{qf.name}</span>\n                </div>\n                <p className=\"text-xs text-gray-600 mb-2\">{qf.label}</p>\n                <p className=\"text-xs font-semibold\" style={{ color: qf.color }}>\n                  {qf.recipientCount.toLocaleString()} recipients\n                </p>\n              </button>\n            ))}\n          </div>\n        </Card>\n      )}\n\n      {/* Filter Conditions */}\n      <Card className=\"p-6\">\n        <h3 className=\"font-semibold mb-4\">Filter Conditions</h3>\n        <div className=\"space-y-3 mb-4\">\n          {conditions.map((condition, index) => (\n            <ConditionRow\n              key={condition.id}\n              condition={condition}\n              onUpdate={(updated) => updateCondition(index, updated)}\n              onDelete={() => deleteCondition(index)}\n            />\n          ))}\n        </div>\n\n        <Button variant=\"outline\" onClick={addCondition} className=\"w-full mb-4\">\n          <Plus className=\"w-4 h-4 mr-2\" />\n          Add Condition\n        </Button>\n      </Card>\n\n      {/* Recipient Count Preview */}\n      <Card className=\"p-4 bg-blue-50 border-blue-200\">\n        <div className=\"flex items-center justify-between\">\n          <div>\n            <p className=\"text-sm text-blue-600 font-medium\">Estimated Recipients</p>\n            <p className=\"text-3xl font-bold text-blue-700 mt-1\">{recipientCount.toLocaleString()}</p>\n          </div>\n          <div className=\"text-right\">\n            <p className=\"text-xs text-blue-600 mb-2\">Updates in real-time as you modify filters</p>\n            <div className=\"w-32 h-2 bg-blue-200 rounded-full overflow-hidden\">\n              <div className=\"h-full bg-blue-600 rounded-full\" style={{ width: `${Math.min(recipientCount / 100, 100)}%` }} />\n            </div>\n          </div>\n        </div>\n      </Card>\n\n      {/* Actions */}\n      <div className=\"flex gap-3 justify-end\">\n        {!showSaveForm ? (\n          <>\n            <Button variant=\"outline\" onClick={() => setShowSaveForm(true)}>\n              <Save className=\"w-4 h-4 mr-2\" />\n              Save as Preset\n            </Button>\n            <Button onClick={handleApply} className=\"bg-blue-600 hover:bg-blue-700\">\n              Apply Filter\n            </Button>\n          </>\n        ) : (\n          <>\n            <div className=\"flex gap-2 w-full\">\n              <Input\n                value={filterName}\n                onChange={(e) => setFilterName(e.target.value)}\n                placeholder=\"Enter preset name\"\n                className=\"flex-1\"\n              />\n              <Button onClick={handleSave} className=\"bg-green-600 hover:bg-green-700\">\n                Save\n              </Button>\n              <Button variant=\"outline\" onClick={() => setShowSaveForm(false)}>\n                Cancel\n              </Button>\n            </div>\n          </>\n        )}\n      </div>\n    </div>\n  );\n};\n\nexport default FilterBuilderUI;\n
