import { describe, it, expect, beforeEach, vi } from 'vitest';\nimport { render, screen, fireEvent, waitFor } from '@testing-library/react';\nimport EmailTemplatePreviewUI from '../EmailTemplatePreviewUI';\nimport FilterBuilderUI from '../FilterBuilderUI';\nimport ScheduleManagementUI from '../ScheduleManagementUI';\n\ndescribe('EmailTemplatePreviewUI', () => {\n  const mockResults = [\n    {\n      client: 'gmail' as const,\n      html: '<div>Test</div>',\n      issues: [],\n      renderingScore: 95,\n    },\n    {\n      client: 'outlook' as const,\n      html: '<div>Test</div>',\n      issues: [\n        {\n          id: 'issue-1',\n          severity: 'critical' as const,\n          message: 'CSS Grid not supported',\n          suggestion: 'Use table-based layout',\n        },\n      ],\n      renderingScore: 60,\n    },\n  ];\n\n  it('should render template preview', () => {\n    render(\n      <EmailTemplatePreviewUI\n        templateId=\"tpl-1\"\n        html=\"<div>Test</div>\"\n        results={mockResults}\n      />\n    );\n\n    expect(screen.getByText('Email Template Preview')).toBeInTheDocument();\n    expect(screen.getByText('tpl-1')).toBeInTheDocument();\n  });\n\n  it('should display client tabs', () => {\n    render(\n      <EmailTemplatePreviewUI\n        templateId=\"tpl-1\"\n        html=\"<div>Test</div>\"\n        results={mockResults}\n      />\n    );\n\n    expect(screen.getByText('Gmail')).toBeInTheDocument();\n    expect(screen.getByText('Outlook')).toBeInTheDocument();\n  });\n\n  it('should switch between clients', () => {\n    render(\n      <EmailTemplatePreviewUI\n        templateId=\"tpl-1\"\n        html=\"<div>Test</div>\"\n        results={mockResults}\n      />\n    );\n\n    const outlookButton = screen.getByText('Outlook');\n    fireEvent.click(outlookButton);\n\n    expect(outlookButton).toHaveClass('border-blue-500');\n  });\n\n  it('should display rendering score', () => {\n    render(\n      <EmailTemplatePreviewUI\n        templateId=\"tpl-1\"\n        html=\"<div>Test</div>\"\n        results={mockResults}\n      />\n    );\n\n    expect(screen.getByText('95%')).toBeInTheDocument();\n  });\n\n  it('should display issues', () => {\n    render(\n      <EmailTemplatePreviewUI\n        templateId=\"tpl-1\"\n        html=\"<div>Test</div>\"\n        results={mockResults}\n      />\n    );\n\n    const outlookButton = screen.getByText('Outlook');\n    fireEvent.click(outlookButton);\n\n    expect(screen.getByText('CSS Grid not supported')).toBeInTheDocument();\n  });\n\n  it('should call onRefresh callback', () => {\n    const onRefresh = vi.fn();\n\n    render(\n      <EmailTemplatePreviewUI\n        templateId=\"tpl-1\"\n        html=\"<div>Test</div>\"\n        results={mockResults}\n        onRefresh={onRefresh}\n      />\n    );\n\n    const refreshButton = screen.getByText('Refresh');\n    fireEvent.click(refreshButton);\n\n    expect(onRefresh).toHaveBeenCalled();\n  });\n\n  it('should copy HTML to clipboard', () => {\n    const mockClipboard = {\n      writeText: vi.fn(),\n    };\n    Object.assign(navigator, { clipboard: mockClipboard });\n\n    render(\n      <EmailTemplatePreviewUI\n        templateId=\"tpl-1\"\n        html=\"<div>Test</div>\"\n        results={mockResults}\n      />\n    );\n\n    const copyButton = screen.getByText('Copy HTML');\n    fireEvent.click(copyButton);\n\n    expect(mockClipboard.writeText).toHaveBeenCalledWith('<div>Test</div>');\n  });\n});\n\ndescribe('FilterBuilderUI', () => {\n  it('should render filter builder', () => {\n    render(<FilterBuilderUI />);\n\n    expect(screen.getByText('Filter Builder')).toBeInTheDocument();\n  });\n\n  it('should have initial condition', () => {\n    render(<FilterBuilderUI />);\n\n    const selects = screen.getAllByRole('combobox');\n    expect(selects.length).toBeGreaterThan(0);\n  });\n\n  it('should add condition', () => {\n    render(<FilterBuilderUI />);\n\n    const addButton = screen.getByText('Add Condition');\n    fireEvent.click(addButton);\n\n    const selects = screen.getAllByRole('combobox');\n    expect(selects.length).toBeGreaterThan(2);\n  });\n\n  it('should display recipient count', () => {\n    render(<FilterBuilderUI />);\n\n    expect(screen.getByText('Estimated Recipients')).toBeInTheDocument();\n  });\n\n  it('should call onApply callback', () => {\n    const onApply = vi.fn();\n\n    render(<FilterBuilderUI onApply={onApply} />);\n\n    const applyButton = screen.getByText('Apply Filter');\n    fireEvent.click(applyButton);\n\n    expect(onApply).toHaveBeenCalled();\n  });\n\n  it('should show save form when clicking save preset', () => {\n    render(<FilterBuilderUI />);\n\n    const saveButton = screen.getByText('Save as Preset');\n    fireEvent.click(saveButton);\n\n    expect(screen.getByPlaceholderText('Enter preset name')).toBeInTheDocument();\n  });\n\n  it('should call onSave with filter name', () => {\n    const onSave = vi.fn();\n\n    render(<FilterBuilderUI onSave={onSave} />);\n\n    const saveButton = screen.getByText('Save as Preset');\n    fireEvent.click(saveButton);\n\n    const input = screen.getByPlaceholderText('Enter preset name');\n    fireEvent.change(input, { target: { value: 'My Filter' } });\n\n    const confirmButton = screen.getByText('Save');\n    fireEvent.click(confirmButton);\n\n    expect(onSave).toHaveBeenCalledWith(expect.any(Array), 'My Filter');\n  });\n\n  it('should display quick filters', () => {\n    const quickFilters = [\n      {\n        id: 'qf-1',\n        name: 'High Engagement',\n        label: 'Engaged users',\n        icon: 'ðŸ“ˆ',\n        color: '#10b981',\n        recipientCount: 5000,\n      },\n    ];\n\n    render(<FilterBuilderUI quickFilters={quickFilters} />);\n\n    expect(screen.getByText('High Engagement')).toBeInTheDocument();\n    expect(screen.getByText('5,000 recipients')).toBeInTheDocument();\n  });\n});\n\ndescribe('ScheduleManagementUI', () => {\n  const mockSchedules = [\n    {\n      id: 'sch-1',\n      name: 'Daily Report',\n      reportType: 'campaign_performance',\n      frequency: 'daily' as const,\n      time: '09:00',\n      recipients: ['user@example.com'],\n      status: 'active' as const,\n      nextRunAt: Date.now() + 24 * 60 * 60 * 1000,\n      runCount: 10,\n      successRate: 95,\n    },\n    {\n      id: 'sch-2',\n      name: 'Weekly Report',\n      reportType: 'recipient_engagement',\n      frequency: 'weekly' as const,\n      time: '10:00',\n      recipients: ['user@example.com'],\n      status: 'paused' as const,\n      nextRunAt: Date.now() + 7 * 24 * 60 * 60 * 1000,\n      runCount: 5,\n      successRate: 100,\n    },\n  ];\n\n  const mockMetrics = {\n    totalSchedules: 2,\n    activeSchedules: 1,\n    pausedSchedules: 1,\n    totalExecutions: 15,\n    successfulExecutions: 14,\n    averageSuccessRate: 97.5,\n  };\n\n  it('should render schedule management', () => {\n    render(\n      <ScheduleManagementUI\n        schedules={mockSchedules}\n        metrics={mockMetrics}\n      />\n    );\n\n    expect(screen.getByText('Report Schedules')).toBeInTheDocument();\n  });\n\n  it('should display metrics', () => {\n    render(\n      <ScheduleManagementUI\n        schedules={mockSchedules}\n        metrics={mockMetrics}\n      />\n    );\n\n    expect(screen.getByText('Total Schedules')).toBeInTheDocument();\n    expect(screen.getByText('2')).toBeInTheDocument();\n  });\n\n  it('should display schedules', () => {\n    render(\n      <ScheduleManagementUI\n        schedules={mockSchedules}\n        metrics={mockMetrics}\n      />\n    );\n\n    expect(screen.getByText('Daily Report')).toBeInTheDocument();\n    expect(screen.getByText('Weekly Report')).toBeInTheDocument();\n  });\n\n  it('should filter schedules by status', () => {\n    render(\n      <ScheduleManagementUI\n        schedules={mockSchedules}\n        metrics={mockMetrics}\n      />\n    );\n\n    const activeButton = screen.getByText('Active');\n    fireEvent.click(activeButton);\n\n    expect(screen.getByText('Daily Report')).toBeInTheDocument();\n    expect(screen.queryByText('Weekly Report')).not.toBeInTheDocument();\n  });\n\n  it('should call onPauseSchedule callback', () => {\n    const onPauseSchedule = vi.fn();\n\n    render(\n      <ScheduleManagementUI\n        schedules={mockSchedules}\n        metrics={mockMetrics}\n        onPauseSchedule={onPauseSchedule}\n      />\n    );\n\n    const pauseButtons = screen.getAllByRole('button').filter((btn) => btn.querySelector('svg'));\n    // Find pause button for active schedule\n    fireEvent.click(pauseButtons[0]);\n\n    expect(onPauseSchedule).toHaveBeenCalled();\n  });\n\n  it('should call onCreateSchedule callback', () => {\n    const onCreateSchedule = vi.fn();\n\n    render(\n      <ScheduleManagementUI\n        schedules={mockSchedules}\n        metrics={mockMetrics}\n        onCreateSchedule={onCreateSchedule}\n      />\n    );\n\n    const createButton = screen.getByText('Create Schedule');\n    fireEvent.click(createButton);\n\n    expect(onCreateSchedule).toHaveBeenCalled();\n  });\n\n  it('should display upcoming schedules', () => {\n    render(\n      <ScheduleManagementUI\n        schedules={mockSchedules}\n        metrics={mockMetrics}\n      />\n    );\n\n    expect(screen.getByText('Upcoming Schedules (Next 7 Days)')).toBeInTheDocument();\n  });\n\n  it('should display success rates', () => {\n    render(\n      <ScheduleManagementUI\n        schedules={mockSchedules}\n        metrics={mockMetrics}\n      />\n    );\n\n    expect(screen.getByText('95.0%')).toBeInTheDocument();\n    expect(screen.getByText('100.0%')).toBeInTheDocument();\n  });\n});\n\ndescribe('UI Components Integration', () => {\n  it('should work together in a workflow', () => {\n    const onApply = vi.fn();\n    const onCreateSchedule = vi.fn();\n\n    // Render filter builder\n    const { unmount: unmountFilter } = render(\n      <FilterBuilderUI onApply={onApply} />\n    );\n\n    const applyButton = screen.getByText('Apply Filter');\n    fireEvent.click(applyButton);\n\n    expect(onApply).toHaveBeenCalled();\n\n    unmountFilter();\n\n    // Render schedule management\n    const mockSchedules = [\n      {\n        id: 'sch-1',\n        name: 'Filtered Report',\n        reportType: 'campaign_performance',\n        frequency: 'daily' as const,\n        time: '09:00',\n        recipients: ['user@example.com'],\n        status: 'active' as const,\n        nextRunAt: Date.now() + 24 * 60 * 60 * 1000,\n        runCount: 1,\n        successRate: 100,\n      },\n    ];\n\n    const mockMetrics = {\n      totalSchedules: 1,\n      activeSchedules: 1,\n      pausedSchedules: 0,\n      totalExecutions: 1,\n      successfulExecutions: 1,\n      averageSuccessRate: 100,\n    };\n\n    render(\n      <ScheduleManagementUI\n        schedules={mockSchedules}\n        metrics={mockMetrics}\n        onCreateSchedule={onCreateSchedule}\n      />\n    );\n\n    expect(screen.getByText('Filtered Report')).toBeInTheDocument();\n  });\n});\n
