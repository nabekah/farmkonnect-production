import React, { useState, useCallback } from 'react';\nimport { Card } from '@/components/ui/card';\nimport { Button } from '@/components/ui/button';\nimport { Tabs, TabsContent, TabsList, TabsTrigger } from '@/components/ui/tabs';\nimport { AlertCircle, CheckCircle, AlertTriangle, Info, Copy, Download, RefreshCw } from 'lucide-react';\n\nexport type EmailClient = 'gmail' | 'outlook' | 'apple' | 'thunderbird' | 'yahoo' | 'generic';\nexport type IssueSeverity = 'critical' | 'warning' | 'info';\n\nexport interface ClientRenderingIssue {\n  id: string;\n  severity: IssueSeverity;\n  message: string;\n  element?: string;\n  suggestion?: string;\n}\n\nexport interface ClientRenderingResult {\n  client: EmailClient;\n  html: string;\n  issues: ClientRenderingIssue[];\n  renderingScore: number;\n}\n\nexport interface EmailTemplatePreviewUIProps {\n  templateId: string;\n  html: string;\n  results: ClientRenderingResult[];\n  onRefresh?: () => void;\n  onExport?: (format: 'html' | 'pdf') => void;\n}\n\nconst CLIENT_NAMES: Record<EmailClient, string> = {\n  gmail: 'Gmail',\n  outlook: 'Outlook',\n  apple: 'Apple Mail',\n  thunderbird: 'Thunderbird',\n  yahoo: 'Yahoo Mail',\n  generic: 'Generic Client',\n};\n\nconst SEVERITY_CONFIG: Record<IssueSeverity, { color: string; icon: React.ReactNode; label: string }> = {\n  critical: {\n    color: 'text-red-600 bg-red-50',\n    icon: <AlertCircle className=\"w-4 h-4\" />,\n    label: 'Critical',\n  },\n  warning: {\n    color: 'text-yellow-600 bg-yellow-50',\n    icon: <AlertTriangle className=\"w-4 h-4\" />,\n    label: 'Warning',\n  },\n  info: {\n    color: 'text-blue-600 bg-blue-50',\n    icon: <Info className=\"w-4 h-4\" />,\n    label: 'Info',\n  },\n};\n\ninterface IssueCardProps {\n  issue: ClientRenderingIssue;\n}\n\nconst IssueCard: React.FC<IssueCardProps> = ({ issue }) => {\n  const config = SEVERITY_CONFIG[issue.severity];\n\n  return (\n    <div className={`p-3 rounded border-l-4 ${config.color} border-current`}>\n      <div className=\"flex items-start gap-3\">\n        <div className=\"mt-1\">{config.icon}</div>\n        <div className=\"flex-1\">\n          <div className=\"flex items-center gap-2 mb-1\">\n            <span className=\"font-semibold text-sm\">{config.label}</span>\n            <span className=\"text-xs font-medium\">{issue.id}</span>\n          </div>\n          <p className=\"text-sm mb-2\">{issue.message}</p>\n          {issue.element && <p className=\"text-xs text-gray-600 mb-2\">Element: {issue.element}</p>}\n          {issue.suggestion && (\n            <div className=\"text-xs bg-white bg-opacity-50 p-2 rounded\">\n              <p className=\"font-semibold mb-1\">Suggestion:</p>\n              <p>{issue.suggestion}</p>\n            </div>\n          )}\n        </div>\n      </div>\n    </div>\n  );\n};\n\ninterface ClientPreviewProps {\n  result: ClientRenderingResult;\n}\n\nconst ClientPreview: React.FC<ClientPreviewProps> = ({ result }) => {\n  const criticalCount = result.issues.filter((i) => i.severity === 'critical').length;\n  const warningCount = result.issues.filter((i) => i.severity === 'warning').length;\n  const infoCount = result.issues.filter((i) => i.severity === 'info').length;\n\n  const getScoreColor = (score: number) => {\n    if (score >= 80) return 'text-green-600';\n    if (score >= 60) return 'text-yellow-600';\n    return 'text-red-600';\n  };\n\n  return (\n    <div className=\"space-y-4\">\n      {/* Score Card */}\n      <Card className=\"p-4 bg-gradient-to-r from-blue-50 to-indigo-50\">\n        <div className=\"flex items-center justify-between\">\n          <div>\n            <p className=\"text-sm text-gray-600 mb-1\">Rendering Score</p>\n            <p className={`text-3xl font-bold ${getScoreColor(result.renderingScore)}`}>\n              {result.renderingScore}%\n            </p>\n          </div>\n          <div className=\"text-right space-y-2\">\n            <div className=\"flex items-center gap-2 text-sm\">\n              <AlertCircle className=\"w-4 h-4 text-red-600\" />\n              <span className=\"font-medium\">{criticalCount} Critical</span>\n            </div>\n            <div className=\"flex items-center gap-2 text-sm\">\n              <AlertTriangle className=\"w-4 h-4 text-yellow-600\" />\n              <span className=\"font-medium\">{warningCount} Warnings</span>\n            </div>\n            <div className=\"flex items-center gap-2 text-sm\">\n              <Info className=\"w-4 h-4 text-blue-600\" />\n              <span className=\"font-medium\">{infoCount} Info</span>\n            </div>\n          </div>\n        </div>\n      </Card>\n\n      {/* Preview */}\n      <Card className=\"p-4\">\n        <h3 className=\"font-semibold mb-3\">Preview</h3>\n        <div className=\"bg-gray-100 rounded p-4 overflow-auto max-h-96\">\n          <iframe\n            srcDoc={result.html}\n            className=\"w-full bg-white rounded border border-gray-300\"\n            style={{ minHeight: '400px' }}\n            title={`Preview for ${result.client}`}\n          />\n        </div>\n      </Card>\n\n      {/* Issues */}\n      {result.issues.length > 0 && (\n        <Card className=\"p-4\">\n          <h3 className=\"font-semibold mb-3\">Issues Found ({result.issues.length})</h3>\n          <div className=\"space-y-3\">\n            {result.issues.map((issue) => (\n              <IssueCard key={issue.id} issue={issue} />\n            ))}\n          </div>\n        </Card>\n      )}\n\n      {result.issues.length === 0 && (\n        <Card className=\"p-4 bg-green-50 border-green-200\">\n          <div className=\"flex items-center gap-3\">\n            <CheckCircle className=\"w-5 h-5 text-green-600\" />\n            <p className=\"text-green-800\">No rendering issues detected for this client!</p>\n          </div>\n        </Card>\n      )}\n    </div>\n  );\n};\n\ninterface ComparisonViewProps {\n  results: ClientRenderingResult[];\n}\n\nconst ComparisonView: React.FC<ComparisonViewProps> = ({ results }) => {\n  return (\n    <div className=\"space-y-4\">\n      <Card className=\"p-4\">\n        <h3 className=\"font-semibold mb-4\">Client Compatibility Matrix</h3>\n        <div className=\"overflow-x-auto\">\n          <table className=\"w-full text-sm\">\n            <thead>\n              <tr className=\"border-b\">\n                <th className=\"text-left py-2 px-3 font-semibold\">Client</th>\n                <th className=\"text-center py-2 px-3 font-semibold\">Score</th>\n                <th className=\"text-center py-2 px-3 font-semibold\">Critical</th>\n                <th className=\"text-center py-2 px-3 font-semibold\">Warnings</th>\n                <th className=\"text-center py-2 px-3 font-semibold\">Status</th>\n              </tr>\n            </thead>\n            <tbody>\n              {results.map((result) => {\n                const criticalCount = result.issues.filter((i) => i.severity === 'critical').length;\n                const warningCount = result.issues.filter((i) => i.severity === 'warning').length;\n                const status = criticalCount > 0 ? 'Poor' : warningCount > 0 ? 'Fair' : 'Good';\n                const statusColor = criticalCount > 0 ? 'text-red-600' : warningCount > 0 ? 'text-yellow-600' : 'text-green-600';\n\n                return (\n                  <tr key={result.client} className=\"border-b hover:bg-gray-50\">\n                    <td className=\"py-3 px-3 font-medium\">{CLIENT_NAMES[result.client]}</td>\n                    <td className=\"text-center py-3 px-3\">\n                      <span className=\"font-bold text-lg\">{result.renderingScore}%</span>\n                    </td>\n                    <td className=\"text-center py-3 px-3\">\n                      {criticalCount > 0 && <span className=\"text-red-600 font-semibold\">{criticalCount}</span>}\n                      {criticalCount === 0 && <span className=\"text-gray-400\">—</span>}\n                    </td>\n                    <td className=\"text-center py-3 px-3\">\n                      {warningCount > 0 && <span className=\"text-yellow-600 font-semibold\">{warningCount}</span>}\n                      {warningCount === 0 && <span className=\"text-gray-400\">—</span>}\n                    </td>\n                    <td className={`text-center py-3 px-3 font-semibold ${statusColor}`}>{status}</td>\n                  </tr>\n                );\n              })}\n            </tbody>\n          </table>\n        </div>\n      </Card>\n\n      <Card className=\"p-4\">\n        <h3 className=\"font-semibold mb-4\">Overall Recommendations</h3>\n        <div className=\"space-y-2 text-sm\">\n          <p className=\"text-gray-700\">\n            Based on the rendering analysis across all clients, here are the key recommendations:\n          </p>\n          <ul className=\"list-disc list-inside space-y-1 text-gray-700\">\n            <li>Test on real devices before sending campaigns</li>\n            <li>Use inline styles for maximum compatibility</li>\n            <li>Provide fallback content for unsupported features</li>\n            <li>Optimize for mobile-first design</li>\n            <li>Use table-based layouts for complex designs</li>\n          </ul>\n        </div>\n      </Card>\n    </div>\n  );\n};\n\nexport const EmailTemplatePreviewUI: React.FC<EmailTemplatePreviewUIProps> = ({\n  templateId,\n  html,\n  results,\n  onRefresh,\n  onExport,\n}) => {\n  const [selectedClient, setSelectedClient] = useState<EmailClient>(results[0]?.client || 'gmail');\n  const selectedResult = results.find((r) => r.client === selectedClient);\n\n  const handleCopyHtml = useCallback(() => {\n    navigator.clipboard.writeText(html);\n  }, [html]);\n\n  const handleExportPDF = useCallback(() => {\n    onExport?.('pdf');\n  }, [onExport]);\n\n  return (\n    <div className=\"space-y-6 max-w-7xl mx-auto\">\n      {/* Header */}\n      <div className=\"flex items-center justify-between\">\n        <div>\n          <h2 className=\"text-2xl font-bold\">Email Template Preview</h2>\n          <p className=\"text-gray-600 text-sm mt-1\">Template ID: {templateId}</p>\n        </div>\n        <div className=\"flex gap-2\">\n          {onRefresh && (\n            <Button variant=\"outline\" onClick={onRefresh}>\n              <RefreshCw className=\"w-4 h-4 mr-2\" />\n              Refresh\n            </Button>\n          )}\n          <Button variant=\"outline\" onClick={handleCopyHtml}>\n            <Copy className=\"w-4 h-4 mr-2\" />\n            Copy HTML\n          </Button>\n          {onExport && (\n            <Button variant=\"outline\" onClick={handleExportPDF}>\n              <Download className=\"w-4 h-4 mr-2\" />\n              Export PDF\n            </Button>\n          )}\n        </div>\n      </div>\n\n      {/* Tabs */}\n      <Tabs defaultValue=\"individual\" className=\"w-full\">\n        <TabsList className=\"grid w-full grid-cols-2\">\n          <TabsTrigger value=\"individual\">Individual Preview</TabsTrigger>\n          <TabsTrigger value=\"comparison\">Comparison</TabsTrigger>\n        </TabsList>\n\n        <TabsContent value=\"individual\" className=\"space-y-4\">\n          {/* Client Selector */}\n          <Card className=\"p-4\">\n            <p className=\"text-sm font-medium mb-3\">Select Email Client</p>\n            <div className=\"grid grid-cols-2 sm:grid-cols-3 lg:grid-cols-6 gap-2\">\n              {results.map((result) => (\n                <button\n                  key={result.client}\n                  onClick={() => setSelectedClient(result.client)}\n                  className={`p-3 rounded border-2 transition-all text-sm font-medium ${\n                    selectedClient === result.client\n                      ? 'border-blue-500 bg-blue-50 text-blue-700'\n                      : 'border-gray-200 hover:border-gray-300 text-gray-700'\n                  }`}\n                >\n                  {CLIENT_NAMES[result.client]}\n                </button>\n              ))}\n            </div>\n          </Card>\n\n          {/* Selected Client Preview */}\n          {selectedResult && <ClientPreview result={selectedResult} />}\n        </TabsContent>\n\n        <TabsContent value=\"comparison\">\n          <ComparisonView results={results} />\n        </TabsContent>\n      </Tabs>\n    </div>\n  );\n};\n\nexport default EmailTemplatePreviewUI;\n
