import React, { useState } from 'react';\nimport { GripHorizontal, X, Settings, Plus } from 'lucide-react';\n\nexport type WidgetType = 'kpi' | 'chart' | 'table' | 'alert' | 'forecast' | 'status';\nexport type WidgetSize = 'small' | 'medium' | 'large' | 'full';\n\nexport interface Widget {\n  id: string;\n  type: WidgetType;\n  title: string;\n  size: WidgetSize;\n  position: number;\n  config: Record<string, any>;\n  enabled: boolean;\n}\n\nexport interface DashboardLayout {\n  id: string;\n  name: string;\n  widgets: Widget[];\n  isDefault: boolean;\n  createdAt: number;\n  updatedAt: number;\n}\n\nconst widgetDefinitions: Record<WidgetType, { name: string; description: string; defaultSize: WidgetSize }> = {\n  kpi: { name: 'KPI Card', description: 'Display key performance indicators', defaultSize: 'small' },\n  chart: { name: 'Chart', description: 'Display data visualizations', defaultSize: 'medium' },\n  table: { name: 'Table', description: 'Display tabular data', defaultSize: 'large' },\n  alert: { name: 'Alerts', description: 'Display system alerts', defaultSize: 'medium' },\n  forecast: { name: 'Forecast', description: 'Display forecasting data', defaultSize: 'medium' },\n  status: { name: 'Status', description: 'Display system status', defaultSize: 'small' },\n};\n\nconst sizeClasses: Record<WidgetSize, string> = {\n  small: 'col-span-1 row-span-1',\n  medium: 'col-span-2 row-span-1',\n  large: 'col-span-2 row-span-2',\n  full: 'col-span-4 row-span-1',\n};\n\ninterface DashboardWidgetsProps {\n  layout?: DashboardLayout;\n  onLayoutChange?: (layout: DashboardLayout) => void;\n  editMode?: boolean;\n}\n\nconst DashboardWidgets: React.FC<DashboardWidgetsProps> = ({\n  layout: initialLayout,\n  onLayoutChange,\n  editMode: initialEditMode = false,\n}) => {\n  const [editMode, setEditMode] = useState(initialEditMode);\n  const [widgets, setWidgets] = useState<Widget[]>(initialLayout?.widgets || []);\n  const [draggedWidget, setDraggedWidget] = useState<string | null>(null);\n  const [showAddWidget, setShowAddWidget] = useState(false);\n\n  const handleAddWidget = (type: WidgetType) => {\n    const def = widgetDefinitions[type];\n    const newWidget: Widget = {\n      id: `widget-${Date.now()}`,\n      type,\n      title: def.name,\n      size: def.defaultSize,\n      position: widgets.length,\n      config: {},\n      enabled: true,\n    };\n\n    const updatedWidgets = [...widgets, newWidget];\n    setWidgets(updatedWidgets);\n    setShowAddWidget(false);\n\n    if (onLayoutChange && initialLayout) {\n      onLayoutChange({ ...initialLayout, widgets: updatedWidgets });\n    }\n  };\n\n  const handleRemoveWidget = (widgetId: string) => {\n    const updatedWidgets = widgets.filter((w) => w.id !== widgetId);\n    setWidgets(updatedWidgets);\n\n    if (onLayoutChange && initialLayout) {\n      onLayoutChange({ ...initialLayout, widgets: updatedWidgets });\n    }\n  };\n\n  const handleResizeWidget = (widgetId: string, newSize: WidgetSize) => {\n    const updatedWidgets = widgets.map((w) => (w.id === widgetId ? { ...w, size: newSize } : w));\n    setWidgets(updatedWidgets);\n\n    if (onLayoutChange && initialLayout) {\n      onLayoutChange({ ...initialLayout, widgets: updatedWidgets });\n    }\n  };\n\n  const handleDragStart = (widgetId: string) => {\n    setDraggedWidget(widgetId);\n  };\n\n  const handleDragOver = (e: React.DragEvent) => {\n    e.preventDefault();\n  };\n\n  const handleDrop = (targetWidgetId: string) => {\n    if (!draggedWidget || draggedWidget === targetWidgetId) return;\n\n    const draggedIndex = widgets.findIndex((w) => w.id === draggedWidget);\n    const targetIndex = widgets.findIndex((w) => w.id === targetWidgetId);\n\n    const newWidgets = [...widgets];\n    [newWidgets[draggedIndex], newWidgets[targetIndex]] = [newWidgets[targetIndex], newWidgets[draggedIndex]];\n\n    const updatedWidgets = newWidgets.map((w, i) => ({ ...w, position: i }));\n    setWidgets(updatedWidgets);\n    setDraggedWidget(null);\n\n    if (onLayoutChange && initialLayout) {\n      onLayoutChange({ ...initialLayout, widgets: updatedWidgets });\n    }\n  };\n\n  return (\n    <div className=\"min-h-screen bg-gray-50 p-6\">\n      <div className=\"max-w-7xl mx-auto\">\n        {/* Header */}\n        <div className=\"flex items-center justify-between mb-8\">\n          <div>\n            <h1 className=\"text-3xl font-bold text-gray-900\">Dashboard</h1>\n            <p className=\"text-gray-600 mt-2\">Customize your farm monitoring dashboard</p>\n          </div>\n          <button\n            onClick={() => setEditMode(!editMode)}\n            className={`px-4 py-2 rounded-lg font-medium transition-colors ${\n              editMode\n                ? 'bg-blue-600 text-white hover:bg-blue-700'\n                : 'bg-gray-200 text-gray-900 hover:bg-gray-300'\n            }`}\n          >\n            {editMode ? 'Done Editing' : 'Edit Layout'}\n          </button>\n        </div>\n\n        {/* Dashboard Grid */}\n        <div className=\"grid grid-cols-4 gap-4 auto-rows-max\">\n          {widgets.map((widget) => (\n            <div\n              key={widget.id}\n              draggable={editMode}\n              onDragStart={() => handleDragStart(widget.id)}\n              onDragOver={handleDragOver}\n              onDrop={() => handleDrop(widget.id)}\n              className={`${\n                sizeClasses[widget.size]\n              } bg-white rounded-lg shadow-sm border border-gray-200 p-6 transition-all ${\n                editMode ? 'cursor-move hover:shadow-md' : ''\n              } ${draggedWidget === widget.id ? 'opacity-50' : ''}`}\n            >\n              {/* Widget Header */}\n              <div className=\"flex items-center justify-between mb-4\">\n                <div className=\"flex items-center gap-2\">\n                  {editMode && <GripHorizontal size={18} className=\"text-gray-400\" />}\n                  <h3 className=\"font-semibold text-gray-900\">{widget.title}</h3>\n                </div>\n                {editMode && (\n                  <div className=\"flex items-center gap-2\">\n                    <button\n                      onClick={() => handleRemoveWidget(widget.id)}\n                      className=\"p-1 hover:bg-red-100 rounded transition-colors\"\n                    >\n                      <X size={18} className=\"text-red-600\" />\n                    </button>\n                  </div>\n                )}\n              </div>\n\n              {/* Widget Content */}\n              <div className=\"flex-1\">\n                {widget.type === 'kpi' && <KPIWidget config={widget.config} />}\n                {widget.type === 'chart' && <ChartWidget config={widget.config} />}\n                {widget.type === 'table' && <TableWidget config={widget.config} />}\n                {widget.type === 'alert' && <AlertWidget config={widget.config} />}\n                {widget.type === 'forecast' && <ForecastWidget config={widget.config} />}\n                {widget.type === 'status' && <StatusWidget config={widget.config} />}\n              </div>\n\n              {/* Widget Footer - Edit Mode */}\n              {editMode && (\n                <div className=\"mt-4 pt-4 border-t border-gray-200\">\n                  <div className=\"flex items-center justify-between\">\n                    <span className=\"text-sm text-gray-600\">Size:</span>\n                    <select\n                      value={widget.size}\n                      onChange={(e) => handleResizeWidget(widget.id, e.target.value as WidgetSize)}\n                      className=\"px-2 py-1 text-sm border border-gray-300 rounded\"\n                    >\n                      <option value=\"small\">Small</option>\n                      <option value=\"medium\">Medium</option>\n                      <option value=\"large\">Large</option>\n                      <option value=\"full\">Full</option>\n                    </select>\n                  </div>\n                </div>\n              )}\n            </div>\n          ))}\n\n          {/* Add Widget Button */}\n          {editMode && (\n            <div className=\"col-span-1 row-span-1 bg-gray-100 rounded-lg border-2 border-dashed border-gray-300 p-6 flex items-center justify-center\">\n              <button\n                onClick={() => setShowAddWidget(!showAddWidget)}\n                className=\"flex flex-col items-center gap-2 text-gray-600 hover:text-gray-900 transition-colors\"\n              >\n                <Plus size={24} />\n                <span className=\"text-sm font-medium\">Add Widget</span>\n              </button>\n            </div>\n          )}\n        </div>\n\n        {/* Add Widget Modal */}\n        {showAddWidget && editMode && (\n          <div className=\"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50\">\n            <div className=\"bg-white rounded-lg p-6 max-w-md w-full mx-4\">\n              <h2 className=\"text-xl font-semibold mb-4\">Add Widget</h2>\n              <div className=\"space-y-2 max-h-96 overflow-y-auto\">\n                {Object.entries(widgetDefinitions).map(([type, def]) => (\n                  <button\n                    key={type}\n                    onClick={() => handleAddWidget(type as WidgetType)}\n                    className=\"w-full text-left px-4 py-3 border border-gray-200 rounded-lg hover:bg-blue-50 hover:border-blue-300 transition-colors\"\n                  >\n                    <p className=\"font-medium text-gray-900\">{def.name}</p>\n                    <p className=\"text-sm text-gray-600\">{def.description}</p>\n                  </button>\n                ))}\n              </div>\n              <button\n                onClick={() => setShowAddWidget(false)}\n                className=\"w-full mt-4 px-4 py-2 border border-gray-300 rounded-lg hover:bg-gray-50 transition-colors\"\n              >\n                Close\n              </button>\n            </div>\n          </div>\n        )}\n      </div>\n    </div>\n  );\n};\n\n// Widget Components\nconst KPIWidget: React.FC<{ config: any }> = ({ config }) => (\n  <div className=\"text-center\">\n    <p className=\"text-3xl font-bold text-blue-600\">$125,400</p>\n    <p className=\"text-sm text-gray-600 mt-2\">Revenue this month</p>\n    <p className=\"text-xs text-green-600 mt-1\">â†‘ 12% from last month</p>\n  </div>\n);\n\nconst ChartWidget: React.FC<{ config: any }> = ({ config }) => (\n  <div className=\"h-48 bg-gray-100 rounded flex items-center justify-center\">\n    <p className=\"text-gray-600\">Chart visualization</p>\n  </div>\n);\n\nconst TableWidget: React.FC<{ config: any }> = ({ config }) => (\n  <div className=\"overflow-x-auto\">\n    <table className=\"w-full text-sm\">\n      <thead>\n        <tr className=\"border-b border-gray-200\">\n          <th className=\"text-left py-2 px-2 font-semibold text-gray-900\">Item</th>\n          <th className=\"text-right py-2 px-2 font-semibold text-gray-900\">Amount</th>\n        </tr>\n      </thead>\n      <tbody>\n        <tr className=\"border-b border-gray-100\">\n          <td className=\"py-2 px-2 text-gray-700\">Seeds</td>\n          <td className=\"text-right py-2 px-2 text-gray-700\">$5,000</td>\n        </tr>\n        <tr className=\"border-b border-gray-100\">\n          <td className=\"py-2 px-2 text-gray-700\">Fertilizer</td>\n          <td className=\"text-right py-2 px-2 text-gray-700\">$3,200</td>\n        </tr>\n      </tbody>\n    </table>\n  </div>\n);\n\nconst AlertWidget: React.FC<{ config: any }> = ({ config }) => (\n  <div className=\"space-y-2\">\n    <div className=\"p-3 bg-red-50 border border-red-200 rounded text-sm text-red-800\">Budget exceeded by 5%</div>\n    <div className=\"p-3 bg-yellow-50 border border-yellow-200 rounded text-sm text-yellow-800\">Maintenance due soon</div>\n  </div>\n);\n\nconst ForecastWidget: React.FC<{ config: any }> = ({ config }) => (\n  <div className=\"space-y-3\">\n    <div className=\"flex justify-between items-center\">\n      <span className=\"text-sm text-gray-600\">Next Month Revenue</span>\n      <span className=\"font-semibold text-gray-900\">$135,000</span>\n    </div>\n    <div className=\"w-full bg-gray-200 rounded-full h-2\">\n      <div className=\"bg-blue-600 h-2 rounded-full\" style={{ width: '75%' }}></div>\n    </div>\n  </div>\n);\n\nconst StatusWidget: React.FC<{ config: any }> = ({ config }) => (\n  <div className=\"flex items-center justify-center\">\n    <div className=\"text-center\">\n      <div className=\"w-12 h-12 bg-green-100 rounded-full flex items-center justify-center mx-auto mb-2\">\n        <div className=\"w-6 h-6 bg-green-600 rounded-full\"></div>\n      </div>\n      <p className=\"text-sm font-medium text-gray-900\">System Healthy</p>\n    </div>\n  </div>\n);\n\nexport default DashboardWidgets;\n
