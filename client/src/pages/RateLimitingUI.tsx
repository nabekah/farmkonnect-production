import { useState, useEffect } from 'react';\nimport { Card, CardContent, CardDescription, CardHeader, CardTitle } from '@/components/ui/card';\nimport { Button } from '@/components/ui/button';\nimport { AlertCircle, TrendingUp, Users, Zap } from 'lucide-react';\n\nexport interface RateLimitConfig {\n  id: string;\n  name: string;\n  tier: 'free' | 'pro' | 'enterprise';\n  requestsPerMinute: number;\n  requestsPerHour: number;\n  requestsPerDay: number;\n  burstLimit: number;\n  enabled: boolean;\n}\n\nexport interface RateLimitUsage {\n  userId: string;\n  endpoint: string;\n  requestsThisMinute: number;\n  requestsThisHour: number;\n  requestsThisDay: number;\n  lastReset: number;\n  throttled: boolean;\n}\n\n/**\n * Rate Limiting Configuration UI\n */\nexport function RateLimitingConfigUI() {\n  const [configs, setConfigs] = useState<RateLimitConfig[]>([\n    {\n      id: 'free',\n      name: 'Free Tier',\n      tier: 'free',\n      requestsPerMinute: 10,\n      requestsPerHour: 100,\n      requestsPerDay: 1000,\n      burstLimit: 15,\n      enabled: true,\n    },\n    {\n      id: 'pro',\n      name: 'Pro Tier',\n      tier: 'pro',\n      requestsPerMinute: 100,\n      requestsPerHour: 5000,\n      requestsPerDay: 100000,\n      burstLimit: 150,\n      enabled: true,\n    },\n    {\n      id: 'enterprise',\n      name: 'Enterprise Tier',\n      tier: 'enterprise',\n      requestsPerMinute: 1000,\n      requestsPerHour: 50000,\n      requestsPerDay: 1000000,\n      burstLimit: 1500,\n      enabled: true,\n    },\n  ]);\n\n  const [editingId, setEditingId] = useState<string | null>(null);\n  const [editValues, setEditValues] = useState<Partial<RateLimitConfig>>({});\n\n  const handleEdit = (config: RateLimitConfig) => {\n    setEditingId(config.id);\n    setEditValues(config);\n  };\n\n  const handleSave = () => {\n    if (editingId) {\n      setConfigs(configs.map((c) => (c.id === editingId ? { ...c, ...editValues } : c)));\n      setEditingId(null);\n    }\n  };\n\n  const handleCancel = () => {\n    setEditingId(null);\n    setEditValues({});\n  };\n\n  const toggleEnabled = (id: string) => {\n    setConfigs(configs.map((c) => (c.id === id ? { ...c, enabled: !c.enabled } : c)));\n  };\n\n  return (\n    <div className=\"space-y-6\">\n      <div>\n        <h2 className=\"text-2xl font-bold\">Rate Limiting Configuration</h2>\n        <p className=\"text-gray-600 mt-2\">Manage API rate limits for different user tiers</p>\n      </div>\n\n      <div className=\"grid gap-4\">\n        {configs.map((config) => (\n          <Card key={config.id} className={!config.enabled ? 'opacity-50' : ''}>\n            <CardHeader>\n              <div className=\"flex items-center justify-between\">\n                <div className=\"flex items-center gap-3\">\n                  <Zap className=\"w-5 h-5 text-yellow-500\" />\n                  <div>\n                    <CardTitle>{config.name}</CardTitle>\n                    <CardDescription>Tier: {config.tier}</CardDescription>\n                  </div>\n                </div>\n                <Button\n                  variant={config.enabled ? 'default' : 'outline'}\n                  onClick={() => toggleEnabled(config.id)}\n                >\n                  {config.enabled ? 'Enabled' : 'Disabled'}\n                </Button>\n              </div>\n            </CardHeader>\n            <CardContent>\n              {editingId === config.id ? (\n                <EditForm\n                  values={editValues}\n                  onChange={setEditValues}\n                  onSave={handleSave}\n                  onCancel={handleCancel}\n                />\n              ) : (\n                <div className=\"space-y-4\">\n                  <div className=\"grid grid-cols-2 gap-4\">\n                    <div className=\"bg-blue-50 p-3 rounded\">\n                      <p className=\"text-sm text-gray-600\">Per Minute</p>\n                      <p className=\"text-2xl font-bold text-blue-600\">{config.requestsPerMinute}</p>\n                    </div>\n                    <div className=\"bg-green-50 p-3 rounded\">\n                      <p className=\"text-sm text-gray-600\">Per Hour</p>\n                      <p className=\"text-2xl font-bold text-green-600\">{config.requestsPerHour}</p>\n                    </div>\n                    <div className=\"bg-purple-50 p-3 rounded\">\n                      <p className=\"text-sm text-gray-600\">Per Day</p>\n                      <p className=\"text-2xl font-bold text-purple-600\">{config.requestsPerDay}</p>\n                    </div>\n                    <div className=\"bg-orange-50 p-3 rounded\">\n                      <p className=\"text-sm text-gray-600\">Burst Limit</p>\n                      <p className=\"text-2xl font-bold text-orange-600\">{config.burstLimit}</p>\n                    </div>\n                  </div>\n                  <Button variant=\"outline\" onClick={() => handleEdit(config)} className=\"w-full\">\n                    Edit Configuration\n                  </Button>\n                </div>\n              )}\n            </CardContent>\n          </Card>\n        ))}\n      </div>\n    </div>\n  );\n}\n\ninterface EditFormProps {\n  values: Partial<RateLimitConfig>;\n  onChange: (values: Partial<RateLimitConfig>) => void;\n  onSave: () => void;\n  onCancel: () => void;\n}\n\nfunction EditForm({ values, onChange, onSave, onCancel }: EditFormProps) {\n  return (\n    <div className=\"space-y-4\">\n      <div className=\"grid grid-cols-2 gap-4\">\n        <div>\n          <label className=\"block text-sm font-medium mb-1\">Requests Per Minute</label>\n          <input\n            type=\"number\"\n            value={values.requestsPerMinute || 0}\n            onChange={(e) => onChange({ ...values, requestsPerMinute: parseInt(e.target.value) })}\n            className=\"w-full px-3 py-2 border rounded\"\n          />\n        </div>\n        <div>\n          <label className=\"block text-sm font-medium mb-1\">Requests Per Hour</label>\n          <input\n            type=\"number\"\n            value={values.requestsPerHour || 0}\n            onChange={(e) => onChange({ ...values, requestsPerHour: parseInt(e.target.value) })}\n            className=\"w-full px-3 py-2 border rounded\"\n          />\n        </div>\n        <div>\n          <label className=\"block text-sm font-medium mb-1\">Requests Per Day</label>\n          <input\n            type=\"number\"\n            value={values.requestsPerDay || 0}\n            onChange={(e) => onChange({ ...values, requestsPerDay: parseInt(e.target.value) })}\n            className=\"w-full px-3 py-2 border rounded\"\n          />\n        </div>\n        <div>\n          <label className=\"block text-sm font-medium mb-1\">Burst Limit</label>\n          <input\n            type=\"number\"\n            value={values.burstLimit || 0}\n            onChange={(e) => onChange({ ...values, burstLimit: parseInt(e.target.value) })}\n            className=\"w-full px-3 py-2 border rounded\"\n          />\n        </div>\n      </div>\n      <div className=\"flex gap-2 justify-end\">\n        <Button variant=\"outline\" onClick={onCancel}>\n          Cancel\n        </Button>\n        <Button onClick={onSave}>Save Changes</Button>\n      </div>\n    </div>\n  );\n}\n\n/**\n * Rate Limiting Usage Monitor\n */\nexport function RateLimitingMonitor() {\n  const [usageData, setUsageData] = useState<RateLimitUsage[]>([\n    {\n      userId: 'user-1',\n      endpoint: '/api/farms',\n      requestsThisMinute: 8,\n      requestsThisHour: 85,\n      requestsThisDay: 950,\n      lastReset: Date.now() - 30000,\n      throttled: false,\n    },\n    {\n      userId: 'user-2',\n      endpoint: '/api/reports',\n      requestsThisMinute: 15,\n      requestsThisHour: 450,\n      requestsThisDay: 8500,\n      lastReset: Date.now() - 15000,\n      throttled: true,\n    },\n  ]);\n\n  const getUsagePercentage = (current: number, limit: number) => {\n    return Math.round((current / limit) * 100);\n  };\n\n  const getUsageColor = (percentage: number) => {\n    if (percentage >= 90) return 'text-red-600 bg-red-50';\n    if (percentage >= 70) return 'text-orange-600 bg-orange-50';\n    return 'text-green-600 bg-green-50';\n  };\n\n  return (\n    <div className=\"space-y-6\">\n      <div>\n        <h2 className=\"text-2xl font-bold\">Rate Limiting Monitor</h2>\n        <p className=\"text-gray-600 mt-2\">Real-time API usage and throttling status</p>\n      </div>\n\n      <div className=\"grid gap-4\">\n        {usageData.map((usage) => (\n          <Card key={`${usage.userId}-${usage.endpoint}`}>\n            <CardHeader>\n              <div className=\"flex items-center justify-between\">\n                <div className=\"flex items-center gap-3\">\n                  <Users className=\"w-5 h-5 text-blue-500\" />\n                  <div>\n                    <CardTitle className=\"text-lg\">{usage.userId}</CardTitle>\n                    <CardDescription>{usage.endpoint}</CardDescription>\n                  </div>\n                </div>\n                {usage.throttled && (\n                  <div className=\"flex items-center gap-2 bg-red-50 px-3 py-1 rounded\">\n                    <AlertCircle className=\"w-4 h-4 text-red-600\" />\n                    <span className=\"text-sm text-red-600\">Throttled</span>\n                  </div>\n                )}\n              </div>\n            </CardHeader>\n            <CardContent>\n              <div className=\"space-y-4\">\n                <UsageBar\n                  label=\"This Minute\"\n                  current={usage.requestsThisMinute}\n                  limit={100}\n                  unit=\"requests\"\n                />\n                <UsageBar\n                  label=\"This Hour\"\n                  current={usage.requestsThisHour}\n                  limit={5000}\n                  unit=\"requests\"\n                />\n                <UsageBar\n                  label=\"This Day\"\n                  current={usage.requestsThisDay}\n                  limit={100000}\n                  unit=\"requests\"\n                />\n              </div>\n            </CardContent>\n          </Card>\n        ))}\n      </div>\n    </div>\n  );\n}\n\ninterface UsageBarProps {\n  label: string;\n  current: number;\n  limit: number;\n  unit: string;\n}\n\nfunction UsageBar({ label, current, limit, unit }: UsageBarProps) {\n  const percentage = Math.round((current / limit) * 100);\n  const color = percentage >= 90 ? 'bg-red-500' : percentage >= 70 ? 'bg-orange-500' : 'bg-green-500';\n\n  return (\n    <div>\n      <div className=\"flex justify-between mb-2\">\n        <span className=\"text-sm font-medium\">{label}</span>\n        <span className=\"text-sm text-gray-600\">\n          {current} / {limit} {unit}\n        </span>\n      </div>\n      <div className=\"w-full bg-gray-200 rounded-full h-2\">\n        <div className={`h-2 rounded-full ${color}`} style={{ width: `${Math.min(percentage, 100)}%` }}></div>\n      </div>\n      <div className=\"text-xs text-gray-500 mt-1\">{percentage}% used</div>\n    </div>\n  );\n}\n\n/**\n * Rate Limiting Dashboard\n */\nexport function RateLimitingDashboard() {\n  const [activeTab, setActiveTab] = useState<'config' | 'monitor'>('config');\n\n  return (\n    <div className=\"min-h-screen bg-gray-50 p-8\">\n      <div className=\"max-w-6xl mx-auto\">\n        <div className=\"flex gap-4 mb-8\">\n          <Button\n            variant={activeTab === 'config' ? 'default' : 'outline'}\n            onClick={() => setActiveTab('config')}\n            className=\"flex items-center gap-2\"\n          >\n            <Zap className=\"w-4 h-4\" />\n            Configuration\n          </Button>\n          <Button\n            variant={activeTab === 'monitor' ? 'default' : 'outline'}\n            onClick={() => setActiveTab('monitor')}\n            className=\"flex items-center gap-2\"\n          >\n            <TrendingUp className=\"w-4 h-4\" />\n            Monitor\n          </Button>\n        </div>\n\n        {activeTab === 'config' && <RateLimitingConfigUI />}\n        {activeTab === 'monitor' && <RateLimitingMonitor />}\n      </div>\n    </div>\n  );\n}\n
