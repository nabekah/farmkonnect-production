import React, { useState, useEffect } from 'react';\nimport { LineChart, Line, BarChart, Bar, XAxis, YAxis, CartesianGrid, Tooltip, Legend, ResponsiveContainer, AreaChart, Area } from 'recharts';\nimport { TrendingUp, AlertCircle, DollarSign, TrendingDown } from 'lucide-react';\n\ninterface ForecastData {\n  period: string;\n  predictedRevenue: number;\n  confidenceInterval: { lower: number; upper: number };\n  trend: 'increasing' | 'decreasing' | 'stable';\n}\n\ninterface ExpensePattern {\n  category: string;\n  averageMonthly: number;\n  seasonalVariation: number;\n  nextMonthPrediction: number;\n}\n\ninterface BudgetVariance {\n  category: string;\n  allocatedAmount: number;\n  actualAmount: number;\n  variance: number;\n  variancePercentage: number;\n  status: 'under' | 'on_track' | 'over';\n}\n\ninterface KPICard {\n  label: string;\n  value: number | string;\n  unit: string;\n  trend: 'up' | 'down' | 'stable';\n  change: number;\n}\n\nconst ForecastingDashboard: React.FC = () => {\n  const [forecasts, setForecasts] = useState<ForecastData[]>([]);\n  const [expensePatterns, setExpensePatterns] = useState<ExpensePattern[]>([]);\n  const [budgetVariances, setBudgetVariances] = useState<BudgetVariance[]>([]);\n  const [selectedCategory, setSelectedCategory] = useState<string>('all');\n  const [timeRange, setTimeRange] = useState<'3m' | '6m' | '12m'>('6m');\n  const [loading, setLoading] = useState(false);\n\n  // Mock data for demonstration\n  useEffect(() => {\n    setLoading(true);\n    setTimeout(() => {\n      const mockForecasts: ForecastData[] = [\n        {\n          period: 'Jan 2026',\n          predictedRevenue: 105000,\n          confidenceInterval: { lower: 95000, upper: 115000 },\n          trend: 'increasing',\n        },\n        {\n          period: 'Feb 2026',\n          predictedRevenue: 110000,\n          confidenceInterval: { lower: 100000, upper: 120000 },\n          trend: 'increasing',\n        },\n        {\n          period: 'Mar 2026',\n          predictedRevenue: 115000,\n          confidenceInterval: { lower: 105000, upper: 125000 },\n          trend: 'increasing',\n        },\n      ];\n\n      const mockExpenses: ExpensePattern[] = [\n        {\n          category: 'labor',\n          averageMonthly: 8000,\n          seasonalVariation: 15,\n          nextMonthPrediction: 8400,\n        },\n        {\n          category: 'seeds',\n          averageMonthly: 3000,\n          seasonalVariation: 25,\n          nextMonthPrediction: 3750,\n        },\n        {\n          category: 'fertilizer',\n          averageMonthly: 2500,\n          seasonalVariation: 20,\n          nextMonthPrediction: 2750,\n        },\n      ];\n\n      const mockVariances: BudgetVariance[] = [\n        {\n          category: 'labor',\n          allocatedAmount: 10000,\n          actualAmount: 8500,\n          variance: 1500,\n          variancePercentage: 15,\n          status: 'under',\n        },\n        {\n          category: 'seeds',\n          allocatedAmount: 5000,\n          actualAmount: 4800,\n          variance: 200,\n          variancePercentage: 4,\n          status: 'on_track',\n        },\n        {\n          category: 'fertilizer',\n          allocatedAmount: 3000,\n          actualAmount: 3200,\n          variance: -200,\n          variancePercentage: -6.7,\n          status: 'over',\n        },\n      ];\n\n      setForecasts(mockForecasts);\n      setExpensePatterns(mockExpenses);\n      setBudgetVariances(mockVariances);\n      setLoading(false);\n    }, 500);\n  }, [timeRange]);\n\n  const KPICard: React.FC<KPICard> = ({ label, value, unit, trend, change }) => (\n    <div className=\"bg-white rounded-lg p-6 shadow-sm border border-gray-200\">\n      <div className=\"flex justify-between items-start\">\n        <div>\n          <p className=\"text-gray-600 text-sm font-medium\">{label}</p>\n          <p className=\"text-2xl font-bold mt-2\">\n            {typeof value === 'number' ? value.toLocaleString() : value}\n            <span className=\"text-gray-400 text-sm ml-2\">{unit}</span>\n          </p>\n        </div>\n        <div className={`p-2 rounded-lg ${\n          trend === 'up' ? 'bg-green-100' : trend === 'down' ? 'bg-red-100' : 'bg-gray-100'\n        }`}>\n          {trend === 'up' && <TrendingUp className=\"text-green-600\" size={20} />}\n          {trend === 'down' && <TrendingDown className=\"text-red-600\" size={20} />}\n          {trend === 'stable' && <DollarSign className=\"text-gray-600\" size={20} />}\n        </div>\n      </div>\n      <p className={`text-sm mt-4 ${\n        trend === 'up' ? 'text-green-600' : trend === 'down' ? 'text-red-600' : 'text-gray-600'\n      }`}>\n        {trend === 'up' ? '+' : ''}{change}% vs last period\n      </p>\n    </div>\n  );\n\n  const RevenueForecastChart = () => (\n    <div className=\"bg-white rounded-lg p-6 shadow-sm border border-gray-200\">\n      <h3 className=\"text-lg font-semibold mb-4\">Revenue Forecast</h3>\n      <ResponsiveContainer width=\"100%\" height={300}>\n        <AreaChart data={forecasts}>\n          <defs>\n            <linearGradient id=\"colorRevenue\" x1=\"0\" y1=\"0\" x2=\"0\" y2=\"1\">\n              <stop offset=\"5%\" stopColor=\"#3b82f6\" stopOpacity={0.8} />\n              <stop offset=\"95%\" stopColor=\"#3b82f6\" stopOpacity={0} />\n            </linearGradient>\n          </defs>\n          <CartesianGrid strokeDasharray=\"3 3\" stroke=\"#e5e7eb\" />\n          <XAxis dataKey=\"period\" stroke=\"#6b7280\" />\n          <YAxis stroke=\"#6b7280\" />\n          <Tooltip\n            contentStyle={{\n              backgroundColor: '#fff',\n              border: '1px solid #e5e7eb',\n              borderRadius: '8px',\n            }}\n          />\n          <Area\n            type=\"monotone\"\n            dataKey=\"predictedRevenue\"\n            stroke=\"#3b82f6\"\n            fillOpacity={1}\n            fill=\"url(#colorRevenue)\"\n            name=\"Predicted Revenue\"\n          />\n        </AreaChart>\n      </ResponsiveContainer>\n    </div>\n  );\n\n  const ExpensePatternChart = () => (\n    <div className=\"bg-white rounded-lg p-6 shadow-sm border border-gray-200\">\n      <h3 className=\"text-lg font-semibold mb-4\">Expense Patterns</h3>\n      <ResponsiveContainer width=\"100%\" height={300}>\n        <BarChart data={expensePatterns}>\n          <CartesianGrid strokeDasharray=\"3 3\" stroke=\"#e5e7eb\" />\n          <XAxis dataKey=\"category\" stroke=\"#6b7280\" />\n          <YAxis stroke=\"#6b7280\" />\n          <Tooltip\n            contentStyle={{\n              backgroundColor: '#fff',\n              border: '1px solid #e5e7eb',\n              borderRadius: '8px',\n            }}\n          />\n          <Legend />\n          <Bar dataKey=\"averageMonthly\" fill=\"#10b981\" name=\"Average Monthly\" />\n          <Bar dataKey=\"nextMonthPrediction\" fill=\"#f59e0b\" name=\"Next Month Prediction\" />\n        </BarChart>\n      </ResponsiveContainer>\n    </div>\n  );\n\n  const BudgetVarianceTable = () => (\n    <div className=\"bg-white rounded-lg p-6 shadow-sm border border-gray-200\">\n      <h3 className=\"text-lg font-semibold mb-4\">Budget Variance Analysis</h3>\n      <div className=\"overflow-x-auto\">\n        <table className=\"w-full\">\n          <thead>\n            <tr className=\"border-b border-gray-200\">\n              <th className=\"text-left py-3 px-4 font-semibold text-gray-700\">Category</th>\n              <th className=\"text-right py-3 px-4 font-semibold text-gray-700\">Allocated</th>\n              <th className=\"text-right py-3 px-4 font-semibold text-gray-700\">Actual</th>\n              <th className=\"text-right py-3 px-4 font-semibold text-gray-700\">Variance</th>\n              <th className=\"text-center py-3 px-4 font-semibold text-gray-700\">Status</th>\n            </tr>\n          </thead>\n          <tbody>\n            {budgetVariances.map((variance) => (\n              <tr key={variance.category} className=\"border-b border-gray-100 hover:bg-gray-50\">\n                <td className=\"py-3 px-4 text-gray-900 font-medium capitalize\">{variance.category}</td>\n                <td className=\"text-right py-3 px-4 text-gray-700\">${variance.allocatedAmount.toLocaleString()}</td>\n                <td className=\"text-right py-3 px-4 text-gray-700\">${variance.actualAmount.toLocaleString()}</td>\n                <td className={`text-right py-3 px-4 font-semibold ${\n                  variance.variance > 0 ? 'text-green-600' : 'text-red-600'\n                }`}>\n                  ${variance.variance.toLocaleString()} ({variance.variancePercentage.toFixed(1)}%)\n                </td>\n                <td className=\"text-center py-3 px-4\">\n                  <span className={`px-3 py-1 rounded-full text-sm font-medium ${\n                    variance.status === 'under'\n                      ? 'bg-green-100 text-green-700'\n                      : variance.status === 'on_track'\n                        ? 'bg-blue-100 text-blue-700'\n                        : 'bg-red-100 text-red-700'\n                  }`}>\n                    {variance.status === 'under' ? 'Under' : variance.status === 'on_track' ? 'On Track' : 'Over'}\n                  </span>\n                </td>\n              </tr>\n            ))}\n          </tbody>\n        </table>\n      </div>\n    </div>\n  );\n\n  return (\n    <div className=\"min-h-screen bg-gray-50 p-6\">\n      <div className=\"max-w-7xl mx-auto\">\n        {/* Header */}\n        <div className=\"mb-8\">\n          <h1 className=\"text-3xl font-bold text-gray-900\">Forecasting Dashboard</h1>\n          <p className=\"text-gray-600 mt-2\">Revenue predictions, expense trends, and budget analysis</p>\n        </div>\n\n        {/* Controls */}\n        <div className=\"flex gap-4 mb-8\">\n          <div className=\"flex gap-2\">\n            {(['3m', '6m', '12m'] as const).map((range) => (\n              <button\n                key={range}\n                onClick={() => setTimeRange(range)}\n                className={`px-4 py-2 rounded-lg font-medium transition-colors ${\n                  timeRange === range\n                    ? 'bg-blue-600 text-white'\n                    : 'bg-white text-gray-700 border border-gray-200 hover:bg-gray-50'\n                }`}\n              >\n                {range === '3m' ? '3 Months' : range === '6m' ? '6 Months' : '12 Months'}\n              </button>\n            ))}\n          </div>\n        </div>\n\n        {/* KPI Cards */}\n        <div className=\"grid grid-cols-1 md:grid-cols-4 gap-4 mb-8\">\n          <KPICard label=\"Avg Revenue\" value={110000} unit=\"$\" trend=\"up\" change={8.5} />\n          <KPICard label=\"Avg Expenses\" value={13500} unit=\"$\" trend=\"down\" change={-2.3} />\n          <KPICard label=\"Profit Margin\" value={87.7} unit=\"%\" trend=\"up\" change={3.2} />\n          <KPICard label=\"Budget Health\" value={92} unit=\"%\" trend=\"stable\" change={0} />\n        </div>\n\n        {/* Charts */}\n        <div className=\"grid grid-cols-1 lg:grid-cols-2 gap-6 mb-8\">\n          <RevenueForecastChart />\n          <ExpensePatternChart />\n        </div>\n\n        {/* Budget Variance Table */}\n        <BudgetVarianceTable />\n\n        {/* Alerts */}\n        <div className=\"mt-8 bg-yellow-50 border border-yellow-200 rounded-lg p-6\">\n          <div className=\"flex gap-4\">\n            <AlertCircle className=\"text-yellow-600 flex-shrink-0\" size={24} />\n            <div>\n              <h3 className=\"font-semibold text-yellow-900\">Forecasting Insights</h3>\n              <ul className=\"mt-2 space-y-1 text-yellow-800 text-sm\">\n                <li>• Revenue trend is increasing with 95% confidence</li>\n                <li>• Fertilizer expenses projected to exceed budget next month</li>\n                <li>• Labor costs trending 12% below budget allocation</li>\n              </ul>\n            </div>\n          </div>\n        </div>\n      </div>\n    </div>\n  );\n};\n\nexport default ForecastingDashboard;\n
