import React, { useState } from 'react';\nimport { Plus, Trash2, Eye, Save, Copy, Settings } from 'lucide-react';\n\nexport interface ReportSection {\n  id: string;\n  type: 'title' | 'text' | 'chart' | 'table' | 'metric' | 'image' | 'divider';\n  title?: string;\n  content?: string;\n  config?: Record<string, any>;\n  condition?: {\n    enabled: boolean;\n    field?: string;\n    operator?: 'eq' | 'ne' | 'gt' | 'lt' | 'contains';\n    value?: any;\n  };\n}\n\nexport interface ReportTemplate {\n  id: string;\n  name: string;\n  description?: string;\n  sections: ReportSection[];\n  metadata?: {\n    author?: string;\n    created?: number;\n    updated?: number;\n    tags?: string[];\n  };\n}\n\nconst sectionTypes = [\n  { value: 'title', label: 'Title', icon: 'ðŸ“' },\n  { value: 'text', label: 'Text Block', icon: 'ðŸ“„' },\n  { value: 'chart', label: 'Chart', icon: 'ðŸ“Š' },\n  { value: 'table', label: 'Table', icon: 'ðŸ“‹' },\n  { value: 'metric', label: 'Metric Card', icon: 'ðŸ“ˆ' },\n  { value: 'image', label: 'Image', icon: 'ðŸ–¼ï¸' },\n  { value: 'divider', label: 'Divider', icon: 'â”€' },\n];\n\nconst ReportTemplateBuilder: React.FC = () => {\n  const [templates, setTemplates] = useState<ReportTemplate[]>([\n    {\n      id: 'template-1',\n      name: 'Weekly Financial Report',\n      description: 'Standard weekly financial summary',\n      sections: [\n        {\n          id: 'section-1',\n          type: 'title',\n          title: 'Weekly Financial Report',\n          content: 'Week of {{startDate}} - {{endDate}}',\n        },\n        {\n          id: 'section-2',\n          type: 'metric',\n          title: 'Revenue',\n          config: { dataSource: 'revenue', format: 'currency' },\n        },\n        {\n          id: 'section-3',\n          type: 'chart',\n          title: 'Daily Revenue Trend',\n          config: { type: 'line', dataSource: 'dailyRevenue' },\n        },\n      ],\n      metadata: {\n        author: 'Admin',\n        created: Date.now(),\n        updated: Date.now(),\n        tags: ['financial', 'weekly'],\n      },\n    },\n  ]);\n\n  const [selectedTemplate, setSelectedTemplate] = useState<ReportTemplate | null>(templates[0]);\n  const [showBuilder, setShowBuilder] = useState(false);\n  const [showPreview, setShowPreview] = useState(false);\n  const [newSectionType, setNewSectionType] = useState<ReportSection['type']>('text');\n\n  const addSection = () => {\n    if (!selectedTemplate) return;\n\n    const newSection: ReportSection = {\n      id: `section-${Date.now()}`,\n      type: newSectionType,\n      title: `New ${newSectionType}`,\n      condition: { enabled: false },\n    };\n\n    const updated = {\n      ...selectedTemplate,\n      sections: [...selectedTemplate.sections, newSection],\n      metadata: { ...selectedTemplate.metadata, updated: Date.now() },\n    };\n\n    setSelectedTemplate(updated);\n    setTemplates(templates.map((t) => (t.id === updated.id ? updated : t)));\n  };\n\n  const removeSection = (sectionId: string) => {\n    if (!selectedTemplate) return;\n\n    const updated = {\n      ...selectedTemplate,\n      sections: selectedTemplate.sections.filter((s) => s.id !== sectionId),\n      metadata: { ...selectedTemplate.metadata, updated: Date.now() },\n    };\n\n    setSelectedTemplate(updated);\n    setTemplates(templates.map((t) => (t.id === updated.id ? updated : t)));\n  };\n\n  const updateSection = (sectionId: string, updates: Partial<ReportSection>) => {\n    if (!selectedTemplate) return;\n\n    const updated = {\n      ...selectedTemplate,\n      sections: selectedTemplate.sections.map((s) =>\n        s.id === sectionId ? { ...s, ...updates } : s\n      ),\n      metadata: { ...selectedTemplate.metadata, updated: Date.now() },\n    };\n\n    setSelectedTemplate(updated);\n    setTemplates(templates.map((t) => (t.id === updated.id ? updated : t)));\n  };\n\n  const moveSection = (sectionId: string, direction: 'up' | 'down') => {\n    if (!selectedTemplate) return;\n\n    const index = selectedTemplate.sections.findIndex((s) => s.id === sectionId);\n    if (index === -1) return;\n\n    const newIndex = direction === 'up' ? index - 1 : index + 1;\n    if (newIndex < 0 || newIndex >= selectedTemplate.sections.length) return;\n\n    const newSections = [...selectedTemplate.sections];\n    [newSections[index], newSections[newIndex]] = [newSections[newIndex], newSections[index]];\n\n    const updated = {\n      ...selectedTemplate,\n      sections: newSections,\n      metadata: { ...selectedTemplate.metadata, updated: Date.now() },\n    };\n\n    setSelectedTemplate(updated);\n    setTemplates(templates.map((t) => (t.id === updated.id ? updated : t)));\n  };\n\n  const saveTemplate = () => {\n    if (!selectedTemplate) return;\n    setTemplates(templates.map((t) => (t.id === selectedTemplate.id ? selectedTemplate : t)));\n    alert('Template saved successfully!');\n  };\n\n  const duplicateTemplate = () => {\n    if (!selectedTemplate) return;\n\n    const newTemplate: ReportTemplate = {\n      ...selectedTemplate,\n      id: `template-${Date.now()}`,\n      name: `${selectedTemplate.name} (Copy)`,\n      metadata: {\n        ...selectedTemplate.metadata,\n        created: Date.now(),\n        updated: Date.now(),\n      },\n    };\n\n    setTemplates([...templates, newTemplate]);\n    setSelectedTemplate(newTemplate);\n  };\n\n  return (\n    <div className=\"min-h-screen bg-gray-50\">\n      <div className=\"grid grid-cols-4 gap-6 p-6 max-w-7xl mx-auto\">\n        {/* Template List */}\n        <div className=\"col-span-1 bg-white rounded-lg shadow-sm border border-gray-200 p-4\">\n          <h2 className=\"text-lg font-semibold mb-4\">Templates</h2>\n          <div className=\"space-y-2\">\n            {templates.map((template) => (\n              <button\n                key={template.id}\n                onClick={() => setSelectedTemplate(template)}\n                className={`w-full text-left px-3 py-2 rounded-lg transition-colors ${\n                  selectedTemplate?.id === template.id\n                    ? 'bg-blue-100 text-blue-900 font-medium'\n                    : 'bg-gray-100 text-gray-900 hover:bg-gray-200'\n                }`}\n              >\n                <div className=\"truncate\">{template.name}</div>\n                <div className=\"text-xs text-gray-500 truncate\">\n                  {template.sections.length} sections\n                </div>\n              </button>\n            ))}\n          </div>\n        </div>\n\n        {/* Builder */}\n        {selectedTemplate && (\n          <div className=\"col-span-3 space-y-6\">\n            {/* Header */}\n            <div className=\"bg-white rounded-lg shadow-sm border border-gray-200 p-6\">\n              <div className=\"flex items-start justify-between mb-4\">\n                <div>\n                  <input\n                    type=\"text\"\n                    value={selectedTemplate.name}\n                    onChange={(e) =>\n                      setSelectedTemplate({\n                        ...selectedTemplate,\n                        name: e.target.value,\n                      })\n                    }\n                    className=\"text-2xl font-bold bg-transparent border-b-2 border-transparent hover:border-gray-300 focus:border-blue-500 outline-none\"\n                  />\n                  <textarea\n                    value={selectedTemplate.description || ''}\n                    onChange={(e) =>\n                      setSelectedTemplate({\n                        ...selectedTemplate,\n                        description: e.target.value,\n                      })\n                    }\n                    className=\"w-full mt-2 p-2 text-sm text-gray-600 border border-gray-200 rounded resize-none focus:outline-none focus:ring-2 focus:ring-blue-500\"\n                    rows={2}\n                    placeholder=\"Template description\"\n                  />\n                </div>\n                <div className=\"flex gap-2\">\n                  <button\n                    onClick={() => setShowPreview(!showPreview)}\n                    className=\"flex items-center gap-2 px-3 py-2 bg-gray-100 text-gray-900 rounded-lg hover:bg-gray-200 transition-colors\"\n                  >\n                    <Eye size={18} />\n                    Preview\n                  </button>\n                  <button\n                    onClick={duplicateTemplate}\n                    className=\"flex items-center gap-2 px-3 py-2 bg-gray-100 text-gray-900 rounded-lg hover:bg-gray-200 transition-colors\"\n                  >\n                    <Copy size={18} />\n                  </button>\n                  <button\n                    onClick={saveTemplate}\n                    className=\"flex items-center gap-2 px-3 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors\"\n                  >\n                    <Save size={18} />\n                    Save\n                  </button>\n                </div>\n              </div>\n            </div>\n\n            {/* Add Section */}\n            <div className=\"bg-white rounded-lg shadow-sm border border-gray-200 p-4\">\n              <div className=\"flex gap-2\">\n                <select\n                  value={newSectionType}\n                  onChange={(e) => setNewSectionType(e.target.value as ReportSection['type'])}\n                  className=\"flex-1 px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500\"\n                >\n                  {sectionTypes.map((type) => (\n                    <option key={type.value} value={type.value}>\n                      {type.label}\n                    </option>\n                  ))}\n                </select>\n                <button\n                  onClick={addSection}\n                  className=\"flex items-center gap-2 px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors\"\n                >\n                  <Plus size={18} />\n                  Add Section\n                </button>\n              </div>\n            </div>\n\n            {/* Sections */}\n            <div className=\"space-y-3\">\n              {selectedTemplate.sections.map((section, index) => (\n                <div\n                  key={section.id}\n                  className=\"bg-white rounded-lg shadow-sm border border-gray-200 p-4\"\n                >\n                  <div className=\"flex items-start justify-between mb-3\">\n                    <div className=\"flex-1\">\n                      <div className=\"flex items-center gap-2 mb-2\">\n                        <span className=\"text-xl\">\n                          {sectionTypes.find((t) => t.value === section.type)?.icon}\n                        </span>\n                        <input\n                          type=\"text\"\n                          value={section.title || ''}\n                          onChange={(e) => updateSection(section.id, { title: e.target.value })}\n                          className=\"text-lg font-semibold bg-transparent border-b border-transparent hover:border-gray-300 focus:border-blue-500 outline-none\"\n                          placeholder=\"Section title\"\n                        />\n                        <span className=\"text-xs text-gray-500 ml-auto\">{section.type}</span>\n                      </div>\n                      {section.type === 'text' && (\n                        <textarea\n                          value={section.content || ''}\n                          onChange={(e) => updateSection(section.id, { content: e.target.value })}\n                          className=\"w-full p-2 text-sm border border-gray-200 rounded resize-none focus:outline-none focus:ring-2 focus:ring-blue-500\"\n                          rows={3}\n                          placeholder=\"Enter text content\"\n                        />\n                      )}\n                    </div>\n                    <div className=\"flex gap-2 ml-4\">\n                      <button\n                        onClick={() => moveSection(section.id, 'up')}\n                        disabled={index === 0}\n                        className=\"p-2 text-gray-600 hover:text-gray-900 disabled:opacity-50 disabled:cursor-not-allowed\"\n                      >\n                        â†‘\n                      </button>\n                      <button\n                        onClick={() => moveSection(section.id, 'down')}\n                        disabled={index === selectedTemplate.sections.length - 1}\n                        className=\"p-2 text-gray-600 hover:text-gray-900 disabled:opacity-50 disabled:cursor-not-allowed\"\n                      >\n                        â†“\n                      </button>\n                      <button\n                        onClick={() => removeSection(section.id)}\n                        className=\"p-2 text-red-600 hover:text-red-900\"\n                      >\n                        <Trash2 size={18} />\n                      </button>\n                    </div>\n                  </div>\n\n                  {/* Conditional Logic */}\n                  <details className=\"mt-3 pt-3 border-t border-gray-200\">\n                    <summary className=\"text-sm font-medium text-gray-700 cursor-pointer hover:text-gray-900\">\n                      Conditional Display\n                    </summary>\n                    <div className=\"mt-3 space-y-2\">\n                      <label className=\"flex items-center gap-2\">\n                        <input\n                          type=\"checkbox\"\n                          checked={section.condition?.enabled || false}\n                          onChange={(e) =>\n                            updateSection(section.id, {\n                              condition: { ...section.condition, enabled: e.target.checked },\n                            })\n                          }\n                          className=\"rounded\"\n                        />\n                        <span className=\"text-sm\">Enable conditional display</span>\n                      </label>\n                      {section.condition?.enabled && (\n                        <div className=\"flex gap-2 text-sm\">\n                          <input\n                            type=\"text\"\n                            placeholder=\"Field name\"\n                            value={section.condition?.field || ''}\n                            onChange={(e) =>\n                              updateSection(section.id, {\n                                condition: { ...section.condition, field: e.target.value },\n                              })\n                            }\n                            className=\"flex-1 px-2 py-1 border border-gray-300 rounded\"\n                          />\n                          <select\n                            value={section.condition?.operator || 'eq'}\n                            onChange={(e) =>\n                              updateSection(section.id, {\n                                condition: {\n                                  ...section.condition,\n                                  operator: e.target.value as any,\n                                },\n                              })\n                            }\n                            className=\"px-2 py-1 border border-gray-300 rounded\"\n                          >\n                            <option value=\"eq\">Equals</option>\n                            <option value=\"ne\">Not equals</option>\n                            <option value=\"gt\">Greater than</option>\n                            <option value=\"lt\">Less than</option>\n                            <option value=\"contains\">Contains</option>\n                          </select>\n                          <input\n                            type=\"text\"\n                            placeholder=\"Value\"\n                            value={section.condition?.value || ''}\n                            onChange={(e) =>\n                              updateSection(section.id, {\n                                condition: { ...section.condition, value: e.target.value },\n                              })\n                            }\n                            className=\"flex-1 px-2 py-1 border border-gray-300 rounded\"\n                          />\n                        </div>\n                      )}\n                    </div>\n                  </details>\n                </div>\n              ))}\n            </div>\n          </div>\n        )}\n      </div>\n\n      {/* Preview Modal */}\n      {showPreview && selectedTemplate && (\n        <div className=\"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50\">\n          <div className=\"bg-white rounded-lg max-w-2xl w-full max-h-96 overflow-y-auto\">\n            <div className=\"sticky top-0 bg-white border-b border-gray-200 p-4 flex items-center justify-between\">\n              <h3 className=\"text-lg font-semibold\">Preview: {selectedTemplate.name}</h3>\n              <button\n                onClick={() => setShowPreview(false)}\n                className=\"text-gray-500 hover:text-gray-700\"\n              >\n                âœ•\n              </button>\n            </div>\n            <div className=\"p-6 space-y-4\">\n              {selectedTemplate.sections.map((section) => (\n                <div key={section.id}>\n                  {section.type === 'title' && (\n                    <h1 className=\"text-2xl font-bold\">{section.title}</h1>\n                  )}\n                  {section.type === 'text' && (\n                    <p className=\"text-gray-700\">{section.content}</p>\n                  )}\n                  {section.type === 'divider' && <hr className=\"my-4\" />}\n                  {section.type === 'metric' && (\n                    <div className=\"bg-blue-50 p-4 rounded-lg\">\n                      <p className=\"text-sm text-gray-600\">{section.title}</p>\n                      <p className=\"text-2xl font-bold text-blue-600\">$0.00</p>\n                    </div>\n                  )}\n                  {section.type === 'chart' && (\n                    <div className=\"bg-gray-100 p-8 rounded-lg text-center text-gray-500\">\n                      Chart: {section.title}\n                    </div>\n                  )}\n                  {section.type === 'table' && (\n                    <div className=\"bg-gray-100 p-8 rounded-lg text-center text-gray-500\">\n                      Table: {section.title}\n                    </div>\n                  )}\n                </div>\n              ))}\n            </div>\n          </div>\n        </div>\n      )}\n    </div>\n  );\n};\n\nexport default ReportTemplateBuilder;\n
