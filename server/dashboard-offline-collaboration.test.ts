import { describe, it, expect, beforeEach } from 'vitest';\nimport { TeamCollaborationManager } from './collaboration';\n\n/**\n * Team Collaboration Manager Tests\n */\ndescribe('Team Collaboration Manager', () => {\n  let collaboration: TeamCollaborationManager;\n\n  beforeEach(() => {\n    collaboration = new TeamCollaborationManager();\n  });\n\n  it('should add team member', () => {\n    const member = collaboration.addTeamMember(\n      'farm-1',\n      'user-1',\n      'John Doe',\n      'john@example.com',\n      'manager'\n    );\n\n    expect(member).not.toBeNull();\n    expect(member.role).toBe('manager');\n    expect(member.permissions.length).toBeGreaterThan(0);\n  });\n\n  it('should get team members', () => {\n    collaboration.addTeamMember('farm-1', 'user-1', 'John', 'john@example.com', 'manager');\n    collaboration.addTeamMember('farm-1', 'user-2', 'Jane', 'jane@example.com', 'worker');\n    collaboration.addTeamMember('farm-2', 'user-3', 'Bob', 'bob@example.com', 'admin');\n\n    const farm1Members = collaboration.getTeamMembers('farm-1');\n    expect(farm1Members.length).toBe(2);\n    expect(farm1Members[0].farmId).toBe('farm-1');\n  });\n\n  it('should update member role', () => {\n    collaboration.addTeamMember('farm-1', 'user-1', 'John', 'john@example.com', 'worker');\n    const updated = collaboration.updateMemberRole('farm-1', 'user-1', 'manager');\n\n    expect(updated).toBe(true);\n    const members = collaboration.getTeamMembers('farm-1');\n    expect(members[0].role).toBe('manager');\n  });\n\n  it('should check permission', () => {\n    collaboration.addTeamMember('farm-1', 'user-1', 'John', 'john@example.com', 'admin');\n    collaboration.addTeamMember('farm-1', 'user-2', 'Jane', 'jane@example.com', 'viewer');\n\n    expect(collaboration.hasPermission('farm-1', 'user-1', 'create_task')).toBe(true);\n    expect(collaboration.hasPermission('farm-1', 'user-2', 'create_task')).toBe(false);\n  });\n\n  it('should create task', () => {\n    collaboration.addTeamMember('farm-1', 'user-1', 'John', 'john@example.com', 'manager');\n    collaboration.addTeamMember('farm-1', 'user-2', 'Jane', 'jane@example.com', 'worker');\n\n    const task = collaboration.createTask(\n      'farm-1',\n      'user-1',\n      'Irrigation Task',\n      'Set up irrigation system',\n      'user-2',\n      'high',\n      Date.now() + 86400000\n    );\n\n    expect(task).not.toBeNull();\n    expect(task.title).toBe('Irrigation Task');\n    expect(task.assignedTo).toBe('user-2');\n    expect(task.status).toBe('pending');\n  });\n\n  it('should get tasks', () => {\n    collaboration.addTeamMember('farm-1', 'user-1', 'John', 'john@example.com', 'manager');\n    collaboration.addTeamMember('farm-1', 'user-2', 'Jane', 'jane@example.com', 'worker');\n\n    collaboration.createTask('farm-1', 'user-1', 'Task 1', 'Desc 1', 'user-2', 'high', Date.now() + 86400000);\n    collaboration.createTask('farm-1', 'user-1', 'Task 2', 'Desc 2', 'user-2', 'medium', Date.now() + 172800000);\n\n    const tasks = collaboration.getTasks('farm-1');\n    expect(tasks.length).toBe(2);\n\n    const userTasks = collaboration.getTasks('farm-1', 'user-2');\n    expect(userTasks.length).toBe(2);\n  });\n\n  it('should update task status', () => {\n    collaboration.addTeamMember('farm-1', 'user-1', 'John', 'john@example.com', 'manager');\n    collaboration.addTeamMember('farm-1', 'user-2', 'Jane', 'jane@example.com', 'worker');\n\n    const task = collaboration.createTask(\n      'farm-1',\n      'user-1',\n      'Task',\n      'Description',\n      'user-2',\n      'high',\n      Date.now() + 86400000\n    );\n\n    const updated = collaboration.updateTaskStatus('farm-1', task.id, 'user-2', 'in-progress');\n    expect(updated).toBe(true);\n\n    const tasks = collaboration.getTasks('farm-1');\n    expect(tasks[0].status).toBe('in-progress');\n  });\n\n  it('should add comment to task', () => {\n    collaboration.addTeamMember('farm-1', 'user-1', 'John', 'john@example.com', 'manager');\n    collaboration.addTeamMember('farm-1', 'user-2', 'Jane', 'jane@example.com', 'worker');\n\n    const task = collaboration.createTask(\n      'farm-1',\n      'user-1',\n      'Task',\n      'Description',\n      'user-2',\n      'high',\n      Date.now() + 86400000\n    );\n\n    const comment = collaboration.addComment('farm-1', task.id, 'user-2', 'This is a comment');\n    expect(comment).not.toBeNull();\n    expect(comment.content).toBe('This is a comment');\n  });\n\n  it('should get task comments', () => {\n    collaboration.addTeamMember('farm-1', 'user-1', 'John', 'john@example.com', 'manager');\n    collaboration.addTeamMember('farm-1', 'user-2', 'Jane', 'jane@example.com', 'worker');\n\n    const task = collaboration.createTask(\n      'farm-1',\n      'user-1',\n      'Task',\n      'Description',\n      'user-2',\n      'high',\n      Date.now() + 86400000\n    );\n\n    collaboration.addComment('farm-1', task.id, 'user-2', 'Comment 1');\n    collaboration.addComment('farm-1', task.id, 'user-1', 'Comment 2');\n\n    const comments = collaboration.getTaskComments(task.id);\n    expect(comments.length).toBe(2);\n  });\n\n  it('should get team stats', () => {\n    collaboration.addTeamMember('farm-1', 'user-1', 'John', 'john@example.com', 'admin');\n    collaboration.addTeamMember('farm-1', 'user-2', 'Jane', 'jane@example.com', 'manager');\n    collaboration.addTeamMember('farm-1', 'user-3', 'Bob', 'bob@example.com', 'worker');\n\n    collaboration.createTask('farm-1', 'user-1', 'Task 1', 'Desc', 'user-2', 'high', Date.now() + 86400000);\n    collaboration.createTask('farm-1', 'user-1', 'Task 2', 'Desc', 'user-3', 'medium', Date.now() + 172800000);\n\n    const stats = collaboration.getTeamStats('farm-1');\n    expect(stats.totalMembers).toBe(3);\n    expect(stats.totalTasks).toBe(2);\n    expect(stats.byRole.admin).toBe(1);\n    expect(stats.byRole.manager).toBe(1);\n    expect(stats.byRole.worker).toBe(1);\n  });\n\n  it('should get task stats', () => {\n    collaboration.addTeamMember('farm-1', 'user-1', 'John', 'john@example.com', 'manager');\n    collaboration.addTeamMember('farm-1', 'user-2', 'Jane', 'jane@example.com', 'worker');\n\n    const task1 = collaboration.createTask(\n      'farm-1',\n      'user-1',\n      'Task 1',\n      'Desc',\n      'user-2',\n      'high',\n      Date.now() + 86400000\n    );\n    const task2 = collaboration.createTask(\n      'farm-1',\n      'user-1',\n      'Task 2',\n      'Desc',\n      'user-2',\n      'urgent',\n      Date.now() + 172800000\n    );\n\n    collaboration.updateTaskStatus('farm-1', task1.id, 'user-2', 'completed');\n\n    const stats = collaboration.getTaskStats('farm-1');\n    expect(stats.total).toBe(2);\n    expect(stats.byStatus.completed).toBe(1);\n    expect(stats.byStatus.pending).toBe(1);\n    expect(stats.byPriority.high).toBe(1);\n    expect(stats.byPriority.urgent).toBe(1);\n  });\n\n  it('should get member permissions', () => {\n    collaboration.addTeamMember('farm-1', 'user-1', 'John', 'john@example.com', 'admin');\n    collaboration.addTeamMember('farm-1', 'user-2', 'Jane', 'jane@example.com', 'viewer');\n\n    const adminPerms = collaboration.getMemberPermissions('farm-1', 'user-1');\n    expect(adminPerms.includes('manage_team')).toBe(true);\n    expect(adminPerms.includes('create_task')).toBe(true);\n\n    const viewerPerms = collaboration.getMemberPermissions('farm-1', 'user-2');\n    expect(viewerPerms.includes('view_team_tasks')).toBe(true);\n    expect(viewerPerms.includes('create_task')).toBe(false);\n  });\n\n  it('should deny permission for unauthorized action', () => {\n    collaboration.addTeamMember('farm-1', 'user-1', 'John', 'john@example.com', 'viewer');\n    collaboration.addTeamMember('farm-1', 'user-2', 'Jane', 'jane@example.com', 'worker');\n\n    expect(() => {\n      collaboration.createTask(\n        'farm-1',\n        'user-1',\n        'Task',\n        'Description',\n        'user-2',\n        'high',\n        Date.now() + 86400000\n      );\n    }).toThrow('Permission denied');\n  });\n});\n\n/**\n * Integration Tests\n */\ndescribe('Integration Tests', () => {\n  it('should work with complete team workflow', () => {\n    const collaboration = new TeamCollaborationManager();\n\n    // Setup team\n    collaboration.addTeamMember('farm-1', 'user-1', 'Manager', 'manager@example.com', 'manager');\n    collaboration.addTeamMember('farm-1', 'user-2', 'Worker', 'worker@example.com', 'worker');\n\n    // Create task\n    const task = collaboration.createTask(\n      'farm-1',\n      'user-1',\n      'Irrigation',\n      'Setup irrigation',\n      'user-2',\n      'high',\n      Date.now() + 86400000\n    );\n\n    // Update task status\n    collaboration.updateTaskStatus('farm-1', task.id, 'user-2', 'in-progress');\n\n    // Add comment\n    collaboration.addComment('farm-1', task.id, 'user-2', 'Started working on this');\n\n    // Get stats\n    const stats = collaboration.getTeamStats('farm-1');\n    expect(stats.totalMembers).toBe(2);\n    expect(stats.totalTasks).toBe(1);\n  });\n});\n
